[{"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t3", "data": {"contest_mode": false, "banned_by": null, "media_embed": {}, "subreddit": "networking", "selftext_html": "&lt;!-- SC_OFF --&gt;&lt;div class=\"md\"&gt;&lt;p&gt;I&amp;#39;ve got a 6500 and a Cisco ASA 5580.  There&amp;#39;s a trunk between them, and I&amp;#39;ve set jumbo frames.  The 6500&amp;#39;s side has an IP MTU of 9216, and the ASA side has an IP MTU of 9198.  Interestingly, when I use an extended ping on the 6500 to ping the ASA with a byte size of 9216 WITH the df-bit set, the ASA responds (not what I expected).  I was shocked, so I ran a pcap on the firewall.  The firewall received the ping. The IP MTU was 9216 bytes in length (value is inclusive of the IP header), and the DF-bit was sit.  The ASA then responds with an echo-reply.  The IP MTU is 9196 bytes in length, and the more-fragments bit is set.  A second packet then sends the remaining fragments.  My question is, why is the ASA ignoring the fact that a packet had the DF-bit set, and fragmenting the packets?&lt;/p&gt;\n&lt;/div&gt;&lt;!-- SC_ON --&gt;", "selftext": "I've got a 6500 and a Cisco ASA 5580.  There's a trunk between them, and I've set jumbo frames.  The 6500's side has an IP MTU of 9216, and the ASA side has an IP MTU of 9198.  Interestingly, when I use an extended ping on the 6500 to ping the ASA with a byte size of 9216 WITH the df-bit set, the ASA responds (not what I expected).  I was shocked, so I ran a pcap on the firewall.  The firewall received the ping. The IP MTU was 9216 bytes in length (value is inclusive of the IP header), and the DF-bit was sit.  The ASA then responds with an echo-reply.  The IP MTU is 9196 bytes in length, and the more-fragments bit is set.  A second packet then sends the remaining fragments.  My question is, why is the ASA ignoring the fact that a packet had the DF-bit set, and fragmenting the packets?", "likes": null, "suggested_sort": null, "user_reports": [], "secure_media": null, "link_flair_text": null, "id": "6548om", "gilded": 0, "secure_media_embed": {}, "clicked": false, "score": 5, "report_reasons": null, "author": "sg4rb0sss", "saved": false, "mod_reports": [], "name": "t3_6548om", "subreddit_name_prefixed": "r/networking", "approved_by": null, "over_18": false, "domain": "self.networking", "hidden": false, "thumbnail": "", "subreddit_id": "t5_2qkaf", "edited": false, "link_flair_css_class": null, "author_flair_css_class": null, "downs": 0, "brand_safe": true, "archived": false, "removal_reason": null, "is_self": true, "hide_score": false, "spoiler": false, "permalink": "/r/networking/comments/6548om/cisco_asa_ignores_dfbit_set/", "num_reports": null, "locked": false, "stickied": false, "created": 1492100855.0, "url": "https://www.reddit.com/r/networking/comments/6548om/cisco_asa_ignores_dfbit_set/", "author_flair_text": null, "quarantine": false, "title": "Cisco ASA Ignores DF-Bit Set", "created_utc": 1492072055.0, "distinguished": null, "media": null, "upvote_ratio": 0.86, "num_comments": 7, "visited": false, "subreddit_type": "public", "ups": 5}}], "after": null, "before": null}}, {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_6548om", "likes": null, "replies": "", "user_reports": [], "id": "dg7ewoa", "gilded": 0, "archived": false, "score": 4, "report_reasons": null, "author": "eduardopozo56", "parent_id": "t3_6548om", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "DF bit is for transport. The ASA is already processing the packet", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;DF bit is for transport. The ASA is already processing the packet&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dg7ewoa", "score_hidden": false, "stickied": false, "created": 1492111117.0, "created_utc": 1492082317.0, "depth": 0, "mod_reports": [], "subreddit_type": "public", "ups": 4}}, {"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_6548om", "likes": null, "replies": "", "user_reports": [], "id": "dg7bz0p", "gilded": 0, "archived": false, "score": 2, "report_reasons": null, "author": "error404", "parent_id": "t3_6548om", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "It's accepting the larger-than-MTU packet (it is maximum *transmission* unit, after all), and it is the ping reply (a new packet) that gets fragmented, so DF is not being violated. A skim of the ICMP RFC suggests it doesn't say anything about copying (or not) the DF flag to the reply.", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;It&amp;#39;s accepting the larger-than-MTU packet (it is maximum &lt;em&gt;transmission&lt;/em&gt; unit, after all), and it is the ping reply (a new packet) that gets fragmented, so DF is not being violated. A skim of the ICMP RFC suggests it doesn&amp;#39;t say anything about copying (or not) the DF flag to the reply.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dg7bz0p", "score_hidden": false, "stickied": false, "created": 1492102615.0, "created_utc": 1492073815.0, "depth": 0, "mod_reports": [], "subreddit_type": "public", "ups": 2}}, {"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_6548om", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_6548om", "likes": null, "replies": "", "user_reports": [], "id": "dg90a5e", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "sg4rb0sss", "parent_id": "t1_dg7ry7g", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "Yeah it's kind of annoying.  Between routers and switches, the Cisco documentation is correct in that it will not fragment the packet on any device in the path, it will respond with a \"message to large\" error.  It's just with this ASA, and aparently Nexus kit too, that it doesn't follow the standard practise.  I guess the only way to work out the exact MTU will be to do a capture on the ASA and ping it with various sizes to work out the exact MTU that it won't fragment it at.  Then I can set this value on the core switch.", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;Yeah it&amp;#39;s kind of annoying.  Between routers and switches, the Cisco documentation is correct in that it will not fragment the packet on any device in the path, it will respond with a &amp;quot;message to large&amp;quot; error.  It&amp;#39;s just with this ASA, and aparently Nexus kit too, that it doesn&amp;#39;t follow the standard practise.  I guess the only way to work out the exact MTU will be to do a capture on the ASA and ping it with various sizes to work out the exact MTU that it won&amp;#39;t fragment it at.  Then I can set this value on the core switch.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dg90a5e", "score_hidden": false, "stickied": false, "created": 1492196470.0, "created_utc": 1492167670.0, "depth": 1, "mod_reports": [], "subreddit_type": "public", "ups": 1}}], "after": null, "before": null}}, "user_reports": [], "id": "dg7ry7g", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "Gesha24", "parent_id": "t3_6548om", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "I've seen similar behavior on Cisco Nexus - by default, it would simply fragment packet if it's larger than MTU and simply send it along.", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;I&amp;#39;ve seen similar behavior on Cisco Nexus - by default, it would simply fragment packet if it&amp;#39;s larger than MTU and simply send it along.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dg7ry7g", "score_hidden": false, "stickied": false, "created": 1492128810.0, "created_utc": 1492100010.0, "depth": 0, "mod_reports": [], "subreddit_type": "public", "ups": 1}}, {"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_6548om", "likes": null, "replies": "", "user_reports": [], "id": "dg82xq9", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "djdawson", "parent_id": "t3_6548om", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "Some devices enforce the interface MTU on all traffic, both transmitted and received, and some devices, Cisco included, enforce it only on transmitted traffic.  In general, Cisco tends to follow the philosophy of \"be flexible in what you accept, and strict in what you send\".  So, I'm not surprised that the ASA was willing to accept an incoming packet that happened to be larger than its interface MTU as long as it could be successfully received.  Also, as /u/error404 pointed out, there is no requirement for the DF bit on the received ICMP Echo Request packet to be copied to the corresponding Echo Reply packet, so I'm not surprised the ASA responded with a fragmented packet, since its interface MTU wasn't large enough to handle the entire reply in a single packet.\n\nOn a slightly related note, Google servers often reply to large pings with much smaller reply packets, even though that's clearly in violation of the standard specified in RFC792.  Go figure...", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;Some devices enforce the interface MTU on all traffic, both transmitted and received, and some devices, Cisco included, enforce it only on transmitted traffic.  In general, Cisco tends to follow the philosophy of &amp;quot;be flexible in what you accept, and strict in what you send&amp;quot;.  So, I&amp;#39;m not surprised that the ASA was willing to accept an incoming packet that happened to be larger than its interface MTU as long as it could be successfully received.  Also, as &lt;a href=\"/u/error404\"&gt;/u/error404&lt;/a&gt; pointed out, there is no requirement for the DF bit on the received ICMP Echo Request packet to be copied to the corresponding Echo Reply packet, so I&amp;#39;m not surprised the ASA responded with a fragmented packet, since its interface MTU wasn&amp;#39;t large enough to handle the entire reply in a single packet.&lt;/p&gt;\n\n&lt;p&gt;On a slightly related note, Google servers often reply to large pings with much smaller reply packets, even though that&amp;#39;s clearly in violation of the standard specified in RFC792.  Go figure...&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dg82xq9", "score_hidden": false, "stickied": false, "created": 1492140546.0, "created_utc": 1492111746.0, "depth": 0, "mod_reports": [], "subreddit_type": "public", "ups": 1}}, {"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_6548om", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_6548om", "likes": null, "replies": "", "user_reports": [], "id": "dg905dh", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "sg4rb0sss", "parent_id": "t1_dg8bhfk", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "Well if you look at the extended ping options on a Cisco device, the documentation states this about the DF bit option:\n\n\" Specifies whether or not the Don't Fragment (DF) bit is to be set on the ping packet. If yes is specified, the Don't Fragment option does not allow this packet to be fragmented when it has to go through a segment with a smaller maximum transmission unit (MTU), and you will receive an error message from the device that wanted to fragment the packet. This is useful for determining the smallest MTU in the path to a destination. The default is no.\"\n\nSo according to the documentation when a larger packet hits a box that needs to fragment it, the box should respond with an error that states the packet is too large.", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;Well if you look at the extended ping options on a Cisco device, the documentation states this about the DF bit option:&lt;/p&gt;\n\n&lt;p&gt;&amp;quot; Specifies whether or not the Don&amp;#39;t Fragment (DF) bit is to be set on the ping packet. If yes is specified, the Don&amp;#39;t Fragment option does not allow this packet to be fragmented when it has to go through a segment with a smaller maximum transmission unit (MTU), and you will receive an error message from the device that wanted to fragment the packet. This is useful for determining the smallest MTU in the path to a destination. The default is no.&amp;quot;&lt;/p&gt;\n\n&lt;p&gt;So according to the documentation when a larger packet hits a box that needs to fragment it, the box should respond with an error that states the packet is too large.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dg905dh", "score_hidden": false, "stickied": false, "created": 1492196071.0, "created_utc": 1492167271.0, "depth": 1, "mod_reports": [], "subreddit_type": "public", "ups": 1}}], "after": null, "before": null}}, "user_reports": [], "id": "dg8bhfk", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "hajji-8", "parent_id": "t3_6548om", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "This is working as expected.\n\nHere is why:\nSideA -&gt; MTUMAX (9216)-&gt; to ASA SideB\n\nSideB -&gt; MTUMAX (9198) -&gt; to SideA\n\nsince there is left over information, it sends a second TCP packet to fill the transaction and complete that tcp stream.\nSideB-&gt; MTUMAX (9198) -&gt; SideA (9216-9198)= remaining info.\n\nThe MTUMAX settings governs the sender's TCP MAX settings, not the partner in the mix.\nYou set an MTUMAX on an escalating traceroute PING to find the maxMTU throughput from your device to a device across the WAN. (Point to point IP traceroute connection.)\n\nunderstand? (maybe you do), but trust me its working correctly.\n", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;This is working as expected.&lt;/p&gt;\n\n&lt;p&gt;Here is why:\nSideA -&amp;gt; MTUMAX (9216)-&amp;gt; to ASA SideB&lt;/p&gt;\n\n&lt;p&gt;SideB -&amp;gt; MTUMAX (9198) -&amp;gt; to SideA&lt;/p&gt;\n\n&lt;p&gt;since there is left over information, it sends a second TCP packet to fill the transaction and complete that tcp stream.\nSideB-&amp;gt; MTUMAX (9198) -&amp;gt; SideA (9216-9198)= remaining info.&lt;/p&gt;\n\n&lt;p&gt;The MTUMAX settings governs the sender&amp;#39;s TCP MAX settings, not the partner in the mix.\nYou set an MTUMAX on an escalating traceroute PING to find the maxMTU throughput from your device to a device across the WAN. (Point to point IP traceroute connection.)&lt;/p&gt;\n\n&lt;p&gt;understand? (maybe you do), but trust me its working correctly.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dg8bhfk", "score_hidden": false, "stickied": false, "created": 1492150484.0, "created_utc": 1492121684.0, "depth": 0, "mod_reports": [], "subreddit_type": "public", "ups": 1}}], "after": null, "before": null}}]