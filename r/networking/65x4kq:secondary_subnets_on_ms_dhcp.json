[{"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t3", "data": {"contest_mode": false, "banned_by": null, "media_embed": {}, "subreddit": "networking", "selftext_html": "&lt;!-- SC_OFF --&gt;&lt;div class=\"md\"&gt;&lt;p&gt;I&amp;#39;ve been tasked with setting up a secondary subnet on our VLANs and I think I&amp;#39;ve got it but I was wondering if anyone could weigh in on their opinion.&lt;/p&gt;\n\n&lt;p&gt;Basically, we mostly use public IP addresses but we also have a secondary subnet that replaces the first octet with &amp;quot;10&amp;quot; and allows traffic within the University network but not out to the Internet.&lt;/p&gt;\n\n&lt;p&gt;I set up the firewall to include the secondary 10. subnet on the existing live subnet interface. Then I set up a Superscope in MS DHCP with two scopes:The 10. scope and the live scope. &lt;/p&gt;\n\n&lt;p&gt;It appears to be working BUT it always hands out the 10. address first. I&amp;#39;m assuming that if the 10. scope was full, it would go on to the live one. I&amp;#39;m trying to figure out if there&amp;#39;s a way to make it pull from the live subnet addresses first.&lt;/p&gt;\n\n&lt;p&gt;My backup plan, since the devices requiring 10. addresses will be known before hand, would be exclude all the addresses in the 10. space and then enable them as we deploy devices.&lt;/p&gt;\n\n&lt;p&gt;Thanks.&lt;/p&gt;\n&lt;/div&gt;&lt;!-- SC_ON --&gt;", "selftext": "I've been tasked with setting up a secondary subnet on our VLANs and I think I've got it but I was wondering if anyone could weigh in on their opinion.\n\nBasically, we mostly use public IP addresses but we also have a secondary subnet that replaces the first octet with \"10\" and allows traffic within the University network but not out to the Internet.\n\nI set up the firewall to include the secondary 10. subnet on the existing live subnet interface. Then I set up a Superscope in MS DHCP with two scopes:The 10. scope and the live scope. \n\nIt appears to be working BUT it always hands out the 10. address first. I'm assuming that if the 10. scope was full, it would go on to the live one. I'm trying to figure out if there's a way to make it pull from the live subnet addresses first.\n\nMy backup plan, since the devices requiring 10. addresses will be known before hand, would be exclude all the addresses in the 10. space and then enable them as we deploy devices.\n\nThanks.", "likes": null, "suggested_sort": null, "user_reports": [], "secure_media": null, "link_flair_text": null, "id": "65x4kq", "gilded": 0, "secure_media_embed": {}, "clicked": false, "score": 5, "report_reasons": null, "author": "cpbreton", "saved": false, "mod_reports": [], "name": "t3_65x4kq", "subreddit_name_prefixed": "r/networking", "approved_by": null, "over_18": false, "domain": "self.networking", "hidden": false, "thumbnail": "", "subreddit_id": "t5_2qkaf", "edited": false, "link_flair_css_class": null, "author_flair_css_class": null, "downs": 0, "brand_safe": true, "archived": false, "removal_reason": null, "is_self": true, "hide_score": false, "spoiler": false, "permalink": "/r/networking/comments/65x4kq/secondary_subnets_on_ms_dhcp/", "num_reports": null, "locked": false, "stickied": false, "created": 1492480241.0, "url": "https://www.reddit.com/r/networking/comments/65x4kq/secondary_subnets_on_ms_dhcp/", "author_flair_text": null, "quarantine": false, "title": "Secondary Subnets on MS DHCP", "created_utc": 1492451441.0, "distinguished": null, "media": null, "upvote_ratio": 0.77, "num_comments": 11, "visited": false, "subreddit_type": "public", "ups": 5}}], "after": null, "before": null}}, {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65x4kq", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65x4kq", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65x4kq", "likes": null, "replies": "", "user_reports": [], "id": "dge4d9o", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "hf0002", "parent_id": "t1_dge124p", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "Yes, but how does their DHCPd decide whether to give you a public or private IP address? What is the criteria? Is it a special reservation, or what?\n\nBTW, \"Class C\" and friends have been obsolete since 1993, but that's just a side note, I suppose :)\n\nedit: Wait, that wasn't a typo? You are giving out addresses in 0/8? I'm surprised that is working at all... that's a reserved range!...", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;Yes, but how does their DHCPd decide whether to give you a public or private IP address? What is the criteria? Is it a special reservation, or what?&lt;/p&gt;\n\n&lt;p&gt;BTW, &amp;quot;Class C&amp;quot; and friends have been obsolete since 1993, but that&amp;#39;s just a side note, I suppose :)&lt;/p&gt;\n\n&lt;p&gt;edit: Wait, that wasn&amp;#39;t a typo? You are giving out addresses in 0/8? I&amp;#39;m surprised that is working at all... that&amp;#39;s a reserved range!...&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dge4d9o", "score_hidden": false, "stickied": false, "created": 1492491882.0, "created_utc": 1492463082.0, "depth": 2, "mod_reports": [], "subreddit_type": "public", "ups": 1}}], "after": null, "before": null}}, "user_reports": [], "id": "dge124p", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "cpbreton", "parent_id": "t1_dgdutn3", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "I'll try to explain why this is not a separate VLAN. At the University where I work, every Class C subnet has 3 sets of 254 addresses. There's the actual public addresses, there're ones that replace the first octet with a 10 which limits that address to on-campus traffic only, and there's one that replaces the first octet with zero and does not route at all. Those all exist on the same VLAN. So VLAN 300 could be 123.123.123.0/24 then within that same VLAN 300 you can also have 10.123.123.0/24 and 0.123.123.0/24.\n\nSince my unit on campus has our own DHCP and DNS we were told to set up a secondary subnet on our firewall (did that) with static ARP and Routing for the 10. addresses. I'm just trying to get our local DHCP server to approximate what the campus wide stuff does. ", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;I&amp;#39;ll try to explain why this is not a separate VLAN. At the University where I work, every Class C subnet has 3 sets of 254 addresses. There&amp;#39;s the actual public addresses, there&amp;#39;re ones that replace the first octet with a 10 which limits that address to on-campus traffic only, and there&amp;#39;s one that replaces the first octet with zero and does not route at all. Those all exist on the same VLAN. So VLAN 300 could be 123.123.123.0/24 then within that same VLAN 300 you can also have 10.123.123.0/24 and 0.123.123.0/24.&lt;/p&gt;\n\n&lt;p&gt;Since my unit on campus has our own DHCP and DNS we were told to set up a secondary subnet on our firewall (did that) with static ARP and Routing for the 10. addresses. I&amp;#39;m just trying to get our local DHCP server to approximate what the campus wide stuff does. &lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dge124p", "score_hidden": false, "stickied": false, "created": 1492488174.0, "created_utc": 1492459374.0, "depth": 1, "mod_reports": [], "subreddit_type": "public", "ups": 1}}], "after": null, "before": null}}, "user_reports": [], "id": "dgdutn3", "gilded": 0, "archived": false, "score": 3, "report_reasons": null, "author": "kcornet", "parent_id": "t3_65x4kq", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "You'll need a separate VLAN for your restricted network with its own associated scope. A superscope isn't what you want.\n\nHow would the DHCP server know whether a client was to get an Internet accessible IP address, or a non-Internet accessible IP address?", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;You&amp;#39;ll need a separate VLAN for your restricted network with its own associated scope. A superscope isn&amp;#39;t what you want.&lt;/p&gt;\n\n&lt;p&gt;How would the DHCP server know whether a client was to get an Internet accessible IP address, or a non-Internet accessible IP address?&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dgdutn3", "score_hidden": false, "stickied": false, "created": 1492481126.0, "created_utc": 1492452326.0, "depth": 0, "mod_reports": [], "subreddit_type": "public", "ups": 3}}, {"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65x4kq", "likes": null, "replies": "", "user_reports": [], "id": "dgdz96i", "gilded": 0, "archived": false, "score": 2, "report_reasons": null, "author": "vNetNinja", "parent_id": "t3_65x4kq", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "Use a different VLAN... and dear god use a private VRF for those 10.x subnets.", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;Use a different VLAN... and dear god use a private VRF for those 10.x subnets.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dgdz96i", "score_hidden": false, "stickied": false, "created": 1492486142.0, "created_utc": 1492457342.0, "depth": 0, "mod_reports": [], "subreddit_type": "public", "ups": 2}}, {"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65x4kq", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65x4kq", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65x4kq", "likes": null, "replies": "", "user_reports": [], "id": "dge2mes", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "PrettyDecentSort", "parent_id": "t1_dge16x3", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "OK, yeah, Microsoft superscopes. This was a phenomenally bad idea when implemented and has not gotten any better. There's some documentation that indicates that child scopes within a superscope are all supposed to be sequential networks within a single summarizable supernet, but this is poorly documented (and poorly implemented, since the GUI imposes no such restrictions).\n\nMy recommendation would still be to redesign your addressing so that the superscopes are unnecessary.", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;OK, yeah, Microsoft superscopes. This was a phenomenally bad idea when implemented and has not gotten any better. There&amp;#39;s some documentation that indicates that child scopes within a superscope are all supposed to be sequential networks within a single summarizable supernet, but this is poorly documented (and poorly implemented, since the GUI imposes no such restrictions).&lt;/p&gt;\n\n&lt;p&gt;My recommendation would still be to redesign your addressing so that the superscopes are unnecessary.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dge2mes", "score_hidden": false, "stickied": false, "created": 1492489914.0, "created_utc": 1492461114.0, "depth": 2, "mod_reports": [], "subreddit_type": "public", "ups": 1}}, {"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65x4kq", "likes": null, "replies": "", "user_reports": [], "id": "dge3sg3", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "atarifan2600", "parent_id": "t1_dge16x3", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "Is the 10.x.x.x really the secondary address on the SVI, or the primary?\n\nI've never seen the switch forward a request forward to an IP Helper with the source gateway being the secondary address.  I didn't think it was possible to DHCP on the secondary Address.\n\nApparently there IS a behavior you can use called \"Smart-relay\", at which point the server looks for a number of failures, and then uses the secondary address as the source.  So in this case, I'd make sure that the 10.x.x.x address was configured as \"secondary\", and that should do it.\n\nAgain, as far as I know, a switch with a DHCP helper will always forward with the primary IP address as the source.\nNOw, if you have the DHCP server LOCAL on that subnet, you're going to start getting interesting results-  at which point you might be better off putting DHCP on a non-local subnet, and falling back to an ip-helper subnet.\n\n\nhttp://www.cisco.com/en/US/docs/ios/12_4t/ip_addr/configuration/guide/htdhcpre.html#wp1089419", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;Is the 10.x.x.x really the secondary address on the SVI, or the primary?&lt;/p&gt;\n\n&lt;p&gt;I&amp;#39;ve never seen the switch forward a request forward to an IP Helper with the source gateway being the secondary address.  I didn&amp;#39;t think it was possible to DHCP on the secondary Address.&lt;/p&gt;\n\n&lt;p&gt;Apparently there IS a behavior you can use called &amp;quot;Smart-relay&amp;quot;, at which point the server looks for a number of failures, and then uses the secondary address as the source.  So in this case, I&amp;#39;d make sure that the 10.x.x.x address was configured as &amp;quot;secondary&amp;quot;, and that should do it.&lt;/p&gt;\n\n&lt;p&gt;Again, as far as I know, a switch with a DHCP helper will always forward with the primary IP address as the source.\nNOw, if you have the DHCP server LOCAL on that subnet, you&amp;#39;re going to start getting interesting results-  at which point you might be better off putting DHCP on a non-local subnet, and falling back to an ip-helper subnet.&lt;/p&gt;\n\n&lt;p&gt;&lt;a href=\"http://www.cisco.com/en/US/docs/ios/12_4t/ip_addr/configuration/guide/htdhcpre.html#wp1089419\"&gt;http://www.cisco.com/en/US/docs/ios/12_4t/ip_addr/configuration/guide/htdhcpre.html#wp1089419&lt;/a&gt;&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dge3sg3", "score_hidden": false, "stickied": false, "created": 1492491220.0, "created_utc": 1492462420.0, "depth": 2, "mod_reports": [], "subreddit_type": "public", "ups": 1}}], "after": null, "before": null}}, "user_reports": [], "id": "dge16x3", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "cpbreton", "parent_id": "t1_dge10rz", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "Yes. Mostly this. So I have no problem with getting the 10.x addresses issued on that interface. That's working as the 10. and 203. (using your example) are both scopes under one superscope.\n\nExcept that in the MS DHCP Server the 10.x shows above the 203. and it gives that address out first. I don't see any way to reorder them. If I put in a reservation for a device on the 203 scope, it will get that, but if there is no reservation it's going to the 10.\n\nThanks.", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;Yes. Mostly this. So I have no problem with getting the 10.x addresses issued on that interface. That&amp;#39;s working as the 10. and 203. (using your example) are both scopes under one superscope.&lt;/p&gt;\n\n&lt;p&gt;Except that in the MS DHCP Server the 10.x shows above the 203. and it gives that address out first. I don&amp;#39;t see any way to reorder them. If I put in a reservation for a device on the 203 scope, it will get that, but if there is no reservation it&amp;#39;s going to the 10.&lt;/p&gt;\n\n&lt;p&gt;Thanks.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dge16x3", "score_hidden": false, "stickied": false, "created": 1492488324.0, "created_utc": 1492459524.0, "depth": 1, "mod_reports": [], "subreddit_type": "public", "ups": 1}}], "after": null, "before": null}}, "user_reports": [], "id": "dge10rz", "gilded": 0, "archived": false, "score": 2, "report_reasons": null, "author": "PrettyDecentSort", "parent_id": "t3_65x4kq", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "Are your 10 addresses a secondary address on the same vlan with your public addresses? e.g.\n\n    interface vlan10\n       ip address 203.0.113.1 255.255.255.0\n       ip address 10.0.113.1 255.255.255.0 secondary\n       ip helper-address 198.51.100.50\n\nIf that's what you're doing, DHCP will never issue 10.x addresses on that interface; that's not how DHCP or helpers work. If you want devices to get 10.x addresses from DHCP then you need to move them to a different vlan where the 10.x address is the primary address on the SVI.\n\nIf you want to overflow from public addresses to private addresses when the public address DHCP pool is exhausted, well, you don't get to do that. Design your network so that that scenario doesn't come into play, for example by using 10.x addresses as primary and then PATting into your public addresses.", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;Are your 10 addresses a secondary address on the same vlan with your public addresses? e.g.&lt;/p&gt;\n\n&lt;pre&gt;&lt;code&gt;interface vlan10\n   ip address 203.0.113.1 255.255.255.0\n   ip address 10.0.113.1 255.255.255.0 secondary\n   ip helper-address 198.51.100.50\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;If that&amp;#39;s what you&amp;#39;re doing, DHCP will never issue 10.x addresses on that interface; that&amp;#39;s not how DHCP or helpers work. If you want devices to get 10.x addresses from DHCP then you need to move them to a different vlan where the 10.x address is the primary address on the SVI.&lt;/p&gt;\n\n&lt;p&gt;If you want to overflow from public addresses to private addresses when the public address DHCP pool is exhausted, well, you don&amp;#39;t get to do that. Design your network so that that scenario doesn&amp;#39;t come into play, for example by using 10.x addresses as primary and then PATting into your public addresses.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dge10rz", "score_hidden": false, "stickied": false, "created": 1492488130.0, "created_utc": 1492459330.0, "depth": 0, "mod_reports": [], "subreddit_type": "public", "ups": 2}}, {"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65x4kq", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65x4kq", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65x4kq", "likes": null, "replies": "", "user_reports": [], "id": "dge391x", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "PrettyDecentSort", "parent_id": "t1_dge1830", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "You guys are just shattering best practices left and right. 0.x/8 is only supposed to be used during DHCP requests: see RFC1122. Well-behaved network stacks will drop those packets silently, and if you're not seeing lots of weird errors using those addresses that's pure luck.\n\nIf you want a proper link-local nonroutable address range, use 169.254.x/16: see RFC3927.", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;You guys are just shattering best practices left and right. 0.x/8 is only supposed to be used during DHCP requests: see RFC1122. Well-behaved network stacks will drop those packets silently, and if you&amp;#39;re not seeing lots of weird errors using those addresses that&amp;#39;s pure luck.&lt;/p&gt;\n\n&lt;p&gt;If you want a proper link-local nonroutable address range, use 169.254.x/16: see RFC3927.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dge391x", "score_hidden": false, "stickied": false, "created": 1492490623.0, "created_utc": 1492461823.0, "depth": 2, "mod_reports": [], "subreddit_type": "public", "ups": 1}}], "after": null, "before": null}}, "user_reports": [], "id": "dge1830", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "cpbreton", "parent_id": "t1_dgdylkq", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "&gt; I'll try to explain why this is not a separate VLAN. At the University where I work, every Class C subnet has 3 sets of 254 addresses. There's the actual public addresses, there're ones that replace the first octet with a 10 which limits that address to on-campus traffic only, and there's one that replaces the first octet with zero and does not route at all. Those all exist on the same VLAN. So VLAN 300 could be 123.123.123.0/24 then within that same VLAN 300 you can also have 10.123.123.0/24 and 0.123.123.0/24.\n&gt; Since my unit on campus has our own DHCP and DNS we were told to set up a secondary subnet on our firewall (did that) with static ARP and Routing for the 10. addresses. I'm just trying to get our local DHCP server to approximate what the campus wide stuff does.\n\n", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;blockquote&gt;\n&lt;p&gt;I&amp;#39;ll try to explain why this is not a separate VLAN. At the University where I work, every Class C subnet has 3 sets of 254 addresses. There&amp;#39;s the actual public addresses, there&amp;#39;re ones that replace the first octet with a 10 which limits that address to on-campus traffic only, and there&amp;#39;s one that replaces the first octet with zero and does not route at all. Those all exist on the same VLAN. So VLAN 300 could be 123.123.123.0/24 then within that same VLAN 300 you can also have 10.123.123.0/24 and 0.123.123.0/24.\nSince my unit on campus has our own DHCP and DNS we were told to set up a secondary subnet on our firewall (did that) with static ARP and Routing for the 10. addresses. I&amp;#39;m just trying to get our local DHCP server to approximate what the campus wide stuff does.&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dge1830", "score_hidden": false, "stickied": false, "created": 1492488361.0, "created_utc": 1492459561.0, "depth": 1, "mod_reports": [], "subreddit_type": "public", "ups": 1}}], "after": null, "before": null}}, "user_reports": [], "id": "dgdylkq", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "UncleSaltine", "parent_id": "t3_65x4kq", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "Okay, let's step back a bit. What problem are you trying to solve? What is the end result you hope to achieve?\n\nI'm not sure exactly what you're trying to do, but based on what you've provided, this doesn't sound like a practical solution to many/most/any problem.", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;Okay, let&amp;#39;s step back a bit. What problem are you trying to solve? What is the end result you hope to achieve?&lt;/p&gt;\n\n&lt;p&gt;I&amp;#39;m not sure exactly what you&amp;#39;re trying to do, but based on what you&amp;#39;ve provided, this doesn&amp;#39;t sound like a practical solution to many/most/any problem.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dgdylkq", "score_hidden": false, "stickied": false, "created": 1492485391.0, "created_utc": 1492456591.0, "depth": 0, "mod_reports": [], "subreddit_type": "public", "ups": 1}}], "after": null, "before": null}}]