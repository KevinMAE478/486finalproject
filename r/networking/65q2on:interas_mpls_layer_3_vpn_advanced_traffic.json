[{"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t3", "data": {"contest_mode": false, "banned_by": null, "media_embed": {}, "subreddit": "networking", "selftext_html": "&lt;!-- SC_OFF --&gt;&lt;div class=\"md\"&gt;&lt;p&gt;Hi All,&lt;/p&gt;\n\n&lt;p&gt;I have a very interesting requirement which I am thinking through, we have inter-as VPN with 2 ISPs, one is &amp;quot;carrier&amp;quot; and the other ISP is where the customer&amp;#39;s CEs are. &lt;/p&gt;\n\n&lt;p&gt;At the moment the carrier ISP is only used as a backup in case the primary link to ISP 2 goes down, we go via their AS for this Inter AS MPLS VPN. However we have a new requirement to utilise this carrier ISP for all VoIP traffic and as a backup in case link to ISP 2 dies.&lt;/p&gt;\n\n&lt;p&gt;We have Diff services TE tunnels on our MPLS core where we route different EXP labels via different tunnels. I have tried multiple ways of accomplishing this and got out of ideas. I am attaching a diagram showing relevant part of the network. &lt;/p&gt;\n\n&lt;p&gt;&lt;a href=\"http://imgur.com/brgtoRU\"&gt;http://imgur.com/brgtoRU&lt;/a&gt;&lt;/p&gt;\n&lt;/div&gt;&lt;!-- SC_ON --&gt;", "selftext": "Hi All,\n\nI have a very interesting requirement which I am thinking through, we have inter-as VPN with 2 ISPs, one is \"carrier\" and the other ISP is where the customer's CEs are. \n\nAt the moment the carrier ISP is only used as a backup in case the primary link to ISP 2 goes down, we go via their AS for this Inter AS MPLS VPN. However we have a new requirement to utilise this carrier ISP for all VoIP traffic and as a backup in case link to ISP 2 dies.\n\nWe have Diff services TE tunnels on our MPLS core where we route different EXP labels via different tunnels. I have tried multiple ways of accomplishing this and got out of ideas. I am attaching a diagram showing relevant part of the network. \n\nhttp://imgur.com/brgtoRU", "likes": null, "suggested_sort": null, "user_reports": [], "secure_media": null, "link_flair_text": null, "id": "65q2on", "gilded": 0, "secure_media_embed": {}, "clicked": false, "score": 17, "report_reasons": null, "author": "melodicaxe", "saved": false, "mod_reports": [], "name": "t3_65q2on", "subreddit_name_prefixed": "r/networking", "approved_by": null, "over_18": false, "domain": "self.networking", "hidden": false, "thumbnail": "", "subreddit_id": "t5_2qkaf", "edited": false, "link_flair_css_class": null, "author_flair_css_class": "", "downs": 0, "brand_safe": true, "archived": false, "removal_reason": null, "is_self": true, "hide_score": false, "spoiler": false, "permalink": "/r/networking/comments/65q2on/interas_mpls_layer_3_vpn_advanced_traffic/", "num_reports": null, "locked": false, "stickied": false, "created": 1492390366.0, "url": "https://www.reddit.com/r/networking/comments/65q2on/interas_mpls_layer_3_vpn_advanced_traffic/", "author_flair_text": "CCNP", "quarantine": false, "title": "Inter-AS MPLS Layer 3 VPN Advanced Traffic Engineering", "created_utc": 1492361566.0, "distinguished": null, "media": null, "upvote_ratio": 0.85, "num_comments": 24, "visited": false, "subreddit_type": "public", "ups": 17}}], "after": null, "before": null}}, {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65q2on", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65q2on", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65q2on", "likes": null, "replies": "", "user_reports": [], "id": "dgdc9tb", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "atlgreenjcc", "parent_id": "t1_dgdbjaz", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "Can you identify VoIP traffic by its destination address? If so, /u/theusz_hamtaahk suggestion is the way (using RTs, comms, or even ACL). \n\nIf you cannot do it, then having different RDs to have visibility of both exits on the PEs, and then use some sort of PBR on DSCP/COS sounds ugly, but feasible. Can't you just give a new RD to the VRFs from 8912 and this customer? \n\nI can\u2019t understand well why you mention the Diff TE tunnels here, that is good  for the transport among AS5 PEs, and your main problem is focused on the exit point.", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;Can you identify VoIP traffic by its destination address? If so, &lt;a href=\"/u/theusz_hamtaahk\"&gt;/u/theusz_hamtaahk&lt;/a&gt; suggestion is the way (using RTs, comms, or even ACL). &lt;/p&gt;\n\n&lt;p&gt;If you cannot do it, then having different RDs to have visibility of both exits on the PEs, and then use some sort of PBR on DSCP/COS sounds ugly, but feasible. Can&amp;#39;t you just give a new RD to the VRFs from 8912 and this customer? &lt;/p&gt;\n\n&lt;p&gt;I can\u2019t understand well why you mention the Diff TE tunnels here, that is good  for the transport among AS5 PEs, and your main problem is focused on the exit point.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dgdc9tb", "score_hidden": false, "stickied": false, "created": 1492453862.0, "created_utc": 1492425062.0, "depth": 2, "mod_reports": [], "subreddit_type": "public", "ups": 1}}, {"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65q2on", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65q2on", "likes": null, "replies": "", "user_reports": [], "id": "dgdkn9f", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "theusz_hamtaahk", "parent_id": "t1_dgdf2nq", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "Do you want to do inter-AS TE? That is not an option for your scenario, since in option B each ASBR changes the next-hop of VPNv4 routes to itself. If you build a tunnel from R1 to R29 and push Voice traffic on R1 into this tunnel, neither R29 nor R21 will be aware of the VPN label which was assigned by R19. You could do this, however, if you had option C.\n\nIf DSCP/EXP is the only thing that distinguishes your Voice traffic, there doesn't seem to be any easy way to implement such a solution. Maybe BGP QPPB but I've never played with this feature outside lab, so can't advise much.", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;Do you want to do inter-AS TE? That is not an option for your scenario, since in option B each ASBR changes the next-hop of VPNv4 routes to itself. If you build a tunnel from R1 to R29 and push Voice traffic on R1 into this tunnel, neither R29 nor R21 will be aware of the VPN label which was assigned by R19. You could do this, however, if you had option C.&lt;/p&gt;\n\n&lt;p&gt;If DSCP/EXP is the only thing that distinguishes your Voice traffic, there doesn&amp;#39;t seem to be any easy way to implement such a solution. Maybe BGP QPPB but I&amp;#39;ve never played with this feature outside lab, so can&amp;#39;t advise much.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dgdkn9f", "score_hidden": false, "stickied": false, "created": 1492469564.0, "created_utc": 1492440764.0, "depth": 3, "mod_reports": [], "subreddit_type": "public", "ups": 1}}], "after": null, "before": null}}, "user_reports": [], "id": "dgdf2nq", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "melodicaxe", "parent_id": "t1_dgdbjaz", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "Each PE exports routes with different RD. My idea was to have the Orange ISP routes exported twice in two different RDs which will enable our PEs to see both in their vpnv4 table.\n\nThe TE will then be used to route this VoIP traffic to the orange ISP subnets via Carrier ASBR, as I don't want regular traffic to go via the carrier ISP only VoIP you see. So what I will then do is assign EXP label on our PEs for the source and destination traffic which I want to match and create tunnel to Carrier ASBR forwarding this EXP label only.", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;Each PE exports routes with different RD. My idea was to have the Orange ISP routes exported twice in two different RDs which will enable our PEs to see both in their vpnv4 table.&lt;/p&gt;\n\n&lt;p&gt;The TE will then be used to route this VoIP traffic to the orange ISP subnets via Carrier ASBR, as I don&amp;#39;t want regular traffic to go via the carrier ISP only VoIP you see. So what I will then do is assign EXP label on our PEs for the source and destination traffic which I want to match and create tunnel to Carrier ASBR forwarding this EXP label only.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dgdf2nq", "score_hidden": false, "stickied": false, "created": 1492460956.0, "created_utc": 1492432156.0, "depth": 2, "mod_reports": [], "subreddit_type": "public", "ups": 1}}], "after": null, "before": null}}, "user_reports": [], "id": "dgdbjaz", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "theusz_hamtaahk", "parent_id": "t1_dgcgcry", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "The fact you have option B (thus, inter-AS TE is useless) leaves you with a limited set of options. \n\nWhy care about RD? Most likely, your Voice and Data subnets are going to be exported with the same RD if they are in the same VRF.\n\nOn the other hand, if you are able to export Voice subnets with a different RT and preserve it across the transit AS, you can use it in the BGP policy in AS5. For example:\n\n    ip extcommunity-list 1 permit rt 100:100\n    route-map rt_test permit 10\n     match extcommunity 1\n     set local-preference 200\n\n    route-policy rt_test\n      if extcommunity rt matches-any (100:100) then\n        set local-preference 200\n      endif\n\nSince in option B ASBRs have visibility of VPNv4 prefixes and make the routing decision, this should work fairly well. \n\nI don't see any use case for TE here, except if you want to alter the intra-AS path.", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;The fact you have option B (thus, inter-AS TE is useless) leaves you with a limited set of options. &lt;/p&gt;\n\n&lt;p&gt;Why care about RD? Most likely, your Voice and Data subnets are going to be exported with the same RD if they are in the same VRF.&lt;/p&gt;\n\n&lt;p&gt;On the other hand, if you are able to export Voice subnets with a different RT and preserve it across the transit AS, you can use it in the BGP policy in AS5. For example:&lt;/p&gt;\n\n&lt;pre&gt;&lt;code&gt;ip extcommunity-list 1 permit rt 100:100\nroute-map rt_test permit 10\n match extcommunity 1\n set local-preference 200\n\nroute-policy rt_test\n  if extcommunity rt matches-any (100:100) then\n    set local-preference 200\n  endif\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;Since in option B ASBRs have visibility of VPNv4 prefixes and make the routing decision, this should work fairly well. &lt;/p&gt;\n\n&lt;p&gt;I don&amp;#39;t see any use case for TE here, except if you want to alter the intra-AS path.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dgdbjaz", "score_hidden": false, "stickied": false, "created": 1492451432.0, "created_utc": 1492422632.0, "depth": 1, "mod_reports": [], "subreddit_type": "public", "ups": 1}}], "after": null, "before": null}}, "user_reports": [], "id": "dgcgcry", "gilded": 0, "archived": false, "score": 3, "report_reasons": null, "author": "melodicaxe", "parent_id": "t3_65q2on", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "My most successful option thus far has been to introduce the ISP2 CEs  networks under different RD into our ISP network. Allowing equal cost load-balancing to ASBRs then having an traffic-eng tunnel to each and allocate single EXP marking on PE (R1) and only allow VoIP traffic via this tunnel. \n\nI am only struggling to get the route re-advertised from Carrier ISP into our ISP with the same RT but different RD.", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;My most successful option thus far has been to introduce the ISP2 CEs  networks under different RD into our ISP network. Allowing equal cost load-balancing to ASBRs then having an traffic-eng tunnel to each and allocate single EXP marking on PE (R1) and only allow VoIP traffic via this tunnel. &lt;/p&gt;\n\n&lt;p&gt;I am only struggling to get the route re-advertised from Carrier ISP into our ISP with the same RT but different RD.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dgcgcry", "score_hidden": false, "stickied": false, "created": 1492399881.0, "created_utc": 1492371081.0, "depth": 0, "mod_reports": [], "subreddit_type": "public", "ups": 3}}, {"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65q2on", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65q2on", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65q2on", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65q2on", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65q2on", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65q2on", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65q2on", "likes": null, "replies": "", "user_reports": [], "id": "dge44th", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "aenertia", "parent_id": "t1_dgd942i", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "I think others have shown examples using LSP and route_maps. You'll have to do this per prefix tho or use vlans. Meaning you'll have to co-ordinate which vlans with your transit provider. FYI evpn using bgp makes this much easier. ", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;I think others have shown examples using LSP and route_maps. You&amp;#39;ll have to do this per prefix tho or use vlans. Meaning you&amp;#39;ll have to co-ordinate which vlans with your transit provider. FYI evpn using bgp makes this much easier. &lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dge44th", "score_hidden": false, "stickied": false, "created": 1492491610.0, "created_utc": 1492462810.0, "depth": 6, "mod_reports": [], "subreddit_type": "public", "ups": 1}}], "after": null, "before": null}}, "user_reports": [], "id": "dgd942i", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "melodicaxe", "parent_id": "t1_dgd156j", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "Why and what mappings are you talking about.", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;Why and what mappings are you talking about.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dgd942i", "score_hidden": false, "stickied": false, "created": 1492443316.0, "created_utc": 1492414516.0, "depth": 5, "mod_reports": [], "subreddit_type": "public", "ups": 1}}], "after": null, "before": null}}, "user_reports": [], "id": "dgd156j", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "aenertia", "parent_id": "t1_dgcofdr", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "Then you are going to need to continue co-coordinating your mappings with your upstream.", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;Then you are going to need to continue co-coordinating your mappings with your upstream.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dgd156j", "score_hidden": false, "stickied": false, "created": 1492427785.0, "created_utc": 1492398985.0, "depth": 4, "mod_reports": [], "subreddit_type": "public", "ups": 1}}], "after": null, "before": null}}, "user_reports": [], "id": "dgcofdr", "gilded": 0, "archived": false, "score": 2, "report_reasons": null, "author": "melodicaxe", "parent_id": "t1_dgco0nm", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "This is not something that is going to change, from MPLS.", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;This is not something that is going to change, from MPLS.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dgcofdr", "score_hidden": false, "stickied": false, "created": 1492410431.0, "created_utc": 1492381631.0, "depth": 3, "mod_reports": [], "subreddit_type": "public", "ups": 2}}], "after": null, "before": null}}, "user_reports": [], "id": "dgco0nm", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "aenertia", "parent_id": "t1_dgcnkbn", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "So craft a MPLS to ACL mapping schema for your Demarc's and dump it into tunnels using OVS or something. Having MPLS at demarc's is never wise; it's expensive, complicated and not guaranteed to be honoured on the link anyway. This is basically what all the major Banks and XLE's do nowdays. i.e Nuage VNS. You use EVPN BGP sessions to advertise specific RD:RT's any way you like and everything becomes vxlan tunnels - which you can class any way you like and transport over any old dumb IP path. MPLS makes sense only in a few small usecases (when you NEED sub 5ms fast failover e.g.) It's been sold into a huge amount of use cases where is was never a good solution by vendors looking to capitalise on thier ASIC investments from the turn of the millennium. We should have been at the IP tunnels doing diffserv years and years ago.", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;So craft a MPLS to ACL mapping schema for your Demarc&amp;#39;s and dump it into tunnels using OVS or something. Having MPLS at demarc&amp;#39;s is never wise; it&amp;#39;s expensive, complicated and not guaranteed to be honoured on the link anyway. This is basically what all the major Banks and XLE&amp;#39;s do nowdays. i.e Nuage VNS. You use EVPN BGP sessions to advertise specific RD:RT&amp;#39;s any way you like and everything becomes vxlan tunnels - which you can class any way you like and transport over any old dumb IP path. MPLS makes sense only in a few small usecases (when you NEED sub 5ms fast failover e.g.) It&amp;#39;s been sold into a huge amount of use cases where is was never a good solution by vendors looking to capitalise on thier ASIC investments from the turn of the millennium. We should have been at the IP tunnels doing diffserv years and years ago.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dgco0nm", "score_hidden": false, "stickied": false, "created": 1492409877.0, "created_utc": 1492381077.0, "depth": 2, "mod_reports": [], "subreddit_type": "public", "ups": 1}}], "after": null, "before": null}}, "user_reports": [], "id": "dgcnkbn", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "melodicaxe", "parent_id": "t1_dgcniel", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "We run MPLS core with diff services tunnels, where we route traffic based on EXP markings.", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;We run MPLS core with diff services tunnels, where we route traffic based on EXP markings.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dgcnkbn", "score_hidden": false, "stickied": false, "created": 1492409271.0, "created_utc": 1492380471.0, "depth": 1, "mod_reports": [], "subreddit_type": "public", "ups": 1}}], "after": null, "before": null}}, "user_reports": [], "id": "dgcniel", "gilded": 0, "archived": false, "score": 2, "report_reasons": null, "author": "aenertia", "parent_id": "t3_65q2on", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "Why use MPLS at all? Can you not just use a bunch of IP Tunnels and some l3 markings to classify them?", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;Why use MPLS at all? Can you not just use a bunch of IP Tunnels and some l3 markings to classify them?&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dgcniel", "score_hidden": false, "stickied": false, "created": 1492409201.0, "created_utc": 1492380401.0, "depth": 0, "mod_reports": [], "subreddit_type": "public", "ups": 2}}, {"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65q2on", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65q2on", "likes": null, "replies": "", "user_reports": [], "id": "dgd8qj9", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "melodicaxe", "parent_id": "t1_dgct6xw", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "A solution to re-do the entire ISP network isnt really a solution.", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;A solution to re-do the entire ISP network isnt really a solution.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dgd8qj9", "score_hidden": false, "stickied": false, "created": 1492442255.0, "created_utc": 1492413455.0, "depth": 1, "mod_reports": [], "subreddit_type": "public", "ups": 1}}], "after": null, "before": null}}, "user_reports": [], "id": "dgct6xw", "gilded": 0, "archived": false, "score": 2, "report_reasons": null, "author": "Honky_Cat", "parent_id": "t3_65q2on", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "Seems like you have a shoot down for every solution provided. Maybe what you look to achieve just won't work for you. ", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;Seems like you have a shoot down for every solution provided. Maybe what you look to achieve just won&amp;#39;t work for you. &lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dgct6xw", "score_hidden": false, "stickied": false, "created": 1492416968.0, "created_utc": 1492388168.0, "depth": 0, "mod_reports": [], "subreddit_type": "public", "ups": 2}}, {"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65q2on", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65q2on", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65q2on", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65q2on", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65q2on", "likes": null, "replies": "", "user_reports": [], "id": "dgcy2bt", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "Firebirdnz", "parent_id": "t1_dgcn72b", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "It all sounds hugely complicated. Unfortunately there isn't a nice and easy way to do it. I work in juniper land and if I had to do this I would match on dscp markings on the VoIP packets and perhaps also the source/destination IPs, depending how much I trusted the markings. At each ingress PE for each direction of traffic flow, and for each of the AS's you would have to use the match statements to set next hop lsp to point it towards the egress node between AS5 and AS8192. Your issue is always going to be the routing algorithm for the next hop. Once you get it to the asbr's it'll do a route lookup and see that there is an extra ASN in the path length to use the other AS. You could local pref it but that'll only work I'd the VoIP is on seperate source and destination networks, and I'm assuming it's not. Basically it's gonna be horrible. Better to redesign it to something you can control properly. ", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;It all sounds hugely complicated. Unfortunately there isn&amp;#39;t a nice and easy way to do it. I work in juniper land and if I had to do this I would match on dscp markings on the VoIP packets and perhaps also the source/destination IPs, depending how much I trusted the markings. At each ingress PE for each direction of traffic flow, and for each of the AS&amp;#39;s you would have to use the match statements to set next hop lsp to point it towards the egress node between AS5 and AS8192. Your issue is always going to be the routing algorithm for the next hop. Once you get it to the asbr&amp;#39;s it&amp;#39;ll do a route lookup and see that there is an extra ASN in the path length to use the other AS. You could local pref it but that&amp;#39;ll only work I&amp;#39;d the VoIP is on seperate source and destination networks, and I&amp;#39;m assuming it&amp;#39;s not. Basically it&amp;#39;s gonna be horrible. Better to redesign it to something you can control properly. &lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dgcy2bt", "score_hidden": false, "stickied": false, "created": 1492423459.0, "created_utc": 1492394659.0, "depth": 4, "mod_reports": [], "subreddit_type": "public", "ups": 1}}], "after": null, "before": null}}, "user_reports": [], "id": "dgcn72b", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "melodicaxe", "parent_id": "t1_dgcmfqh", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "All 3 ISPs are separate MPLS networks, only certain RTs are advertised on ASBRs. TEs are only local to each ISP and terminate on ASBRs. Psuedowire would require whole rebuild of the customer network. The network is functioning as it is, with transit ISP being used as a backup. This is a simple requirement to utilise this backup ISP transit for VoIP rather than sitting idle.\n\nI haven't had any issues with external-mbgp, we also translate rt on each ASBR from one ext comm to another as they overlap.", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;All 3 ISPs are separate MPLS networks, only certain RTs are advertised on ASBRs. TEs are only local to each ISP and terminate on ASBRs. Psuedowire would require whole rebuild of the customer network. The network is functioning as it is, with transit ISP being used as a backup. This is a simple requirement to utilise this backup ISP transit for VoIP rather than sitting idle.&lt;/p&gt;\n\n&lt;p&gt;I haven&amp;#39;t had any issues with external-mbgp, we also translate rt on each ASBR from one ext comm to another as they overlap.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dgcn72b", "score_hidden": false, "stickied": false, "created": 1492408801.0, "created_utc": 1492380001.0, "depth": 3, "mod_reports": [], "subreddit_type": "public", "ups": 1}}], "after": null, "before": null}}, "user_reports": [], "id": "dgcmfqh", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "Firebirdnz", "parent_id": "t1_dgcjmje", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "This is just a super odd setup which is why I asked whether you controlled all the AS's. I'm not sure the use case of this setup. You'll have issues with external-mbgp, igp metrics and TE advertisements and also labels at AS boundaries. In the real world this would be a crazy setup. I would opt to build each AS as it's own mpls domain. At the AS boundaries build point to point networks with ebgp inet family to advertise routes like any other bgp peering. Forget all the labels and MBGP. Also in terms of the AS you are transiting only with any CEs you could just get a psuedowire instead. Less complicated all around. ", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;This is just a super odd setup which is why I asked whether you controlled all the AS&amp;#39;s. I&amp;#39;m not sure the use case of this setup. You&amp;#39;ll have issues with external-mbgp, igp metrics and TE advertisements and also labels at AS boundaries. In the real world this would be a crazy setup. I would opt to build each AS as it&amp;#39;s own mpls domain. At the AS boundaries build point to point networks with ebgp inet family to advertise routes like any other bgp peering. Forget all the labels and MBGP. Also in terms of the AS you are transiting only with any CEs you could just get a psuedowire instead. Less complicated all around. &lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dgcmfqh", "score_hidden": false, "stickied": false, "created": 1492407784.0, "created_utc": 1492378984.0, "depth": 2, "mod_reports": [], "subreddit_type": "public", "ups": 1}}, {"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65q2on", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65q2on", "likes": null, "replies": "", "user_reports": [], "id": "dgdb5ak", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "melodicaxe", "parent_id": "t1_dgdb3s0", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "Not ideal, as we have around 50 separate customers on ISP Orange. Would option A make it possible to insert two routes into vpnv4 table?", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;Not ideal, as we have around 50 separate customers on ISP Orange. Would option A make it possible to insert two routes into vpnv4 table?&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dgdb5ak", "score_hidden": false, "stickied": false, "created": 1492450088.0, "created_utc": 1492421288.0, "depth": 3, "mod_reports": [], "subreddit_type": "public", "ups": 1}}], "after": null, "before": null}}, "user_reports": [], "id": "dgdb3s0", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "jahm4l", "parent_id": "t1_dgcjmje", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "Do you have any chance to put that service in a different VLAN and exchange the routes via Option A?", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;Do you have any chance to put that service in a different VLAN and exchange the routes via Option A?&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dgdb3s0", "score_hidden": false, "stickied": false, "created": 1492449944.0, "created_utc": 1492421144.0, "depth": 2, "mod_reports": [], "subreddit_type": "public", "ups": 1}}], "after": null, "before": null}}, "user_reports": [], "id": "dgcjmje", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "melodicaxe", "parent_id": "t1_dgcjfil", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "I've got 2 Inter-AS option B MPLS VPNs, one going via the orange circle ISP and one going directly into red circle ISP.\n\nThe end goal is to have VoIP traffic when going to one of the red circle ISPs CEs to always prefer orange circle ISP as transit.", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;I&amp;#39;ve got 2 Inter-AS option B MPLS VPNs, one going via the orange circle ISP and one going directly into red circle ISP.&lt;/p&gt;\n\n&lt;p&gt;The end goal is to have VoIP traffic when going to one of the red circle ISPs CEs to always prefer orange circle ISP as transit.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dgcjmje", "score_hidden": false, "stickied": false, "created": 1492404117.0, "created_utc": 1492375317.0, "depth": 1, "mod_reports": [], "subreddit_type": "public", "ups": 1}}], "after": null, "before": null}}, "user_reports": [], "id": "dgcjfil", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "Firebirdnz", "parent_id": "t3_65q2on", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "I'm rather confused as to what this setup is. Are both AS's controlled by you? ", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;I&amp;#39;m rather confused as to what this setup is. Are both AS&amp;#39;s controlled by you? &lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dgcjfil", "score_hidden": false, "stickied": false, "created": 1492403864.0, "created_utc": 1492375064.0, "depth": 0, "mod_reports": [], "subreddit_type": "public", "ups": 1}}, {"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65q2on", "likes": null, "replies": "", "user_reports": [], "id": "dgdratt", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "jiannone", "parent_id": "t3_65q2on", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "You probably need more tunnels.  Build VOIP LSPs between R22 and R29 and install the VOIP destination prefix into the VOIP LSP at R22.  Now all traffic destined for VOIP egresses R29 and other IP traffic could transit R29 or R18.", "edited": 1492450666.0, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;You probably need more tunnels.  Build VOIP LSPs between R22 and R29 and install the VOIP destination prefix into the VOIP LSP at R22.  Now all traffic destined for VOIP egresses R29 and other IP traffic could transit R29 or R18.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dgdratt", "score_hidden": false, "stickied": false, "created": 1492477233.0, "created_utc": 1492448433.0, "depth": 0, "mod_reports": [], "subreddit_type": "public", "ups": 1}}, {"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65q2on", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65q2on", "likes": null, "replies": "", "user_reports": [], "id": "dgcia0x", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "melodicaxe", "parent_id": "t1_dgcgfo4", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "not an option", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;not an option&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dgcia0x", "score_hidden": false, "stickied": false, "created": 1492402379.0, "created_utc": 1492373579.0, "depth": 1, "mod_reports": [], "subreddit_type": "public", "ups": 1}}], "after": null, "before": null}}, "user_reports": [], "id": "dgcgfo4", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "the-packet-thrower", "parent_id": "t3_65q2on", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "Or just setup IWAN on your CEs ;)", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;Or just setup IWAN on your CEs ;)&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dgcgfo4", "score_hidden": false, "stickied": false, "created": 1492399982.0, "created_utc": 1492371182.0, "depth": 0, "mod_reports": [], "subreddit_type": "public", "ups": 1}}], "after": null, "before": null}}]