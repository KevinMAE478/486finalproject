[{"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t3", "data": {"contest_mode": false, "banned_by": null, "media_embed": {}, "subreddit": "networking", "selftext_html": "&lt;!-- SC_OFF --&gt;&lt;div class=\"md\"&gt;&lt;p&gt;Hello everyone, first post on &lt;a href=\"/r/networking\"&gt;r/networking&lt;/a&gt; so hopefully I&amp;#39;m not breaking any rules. (mods, feel free to remove if it does)&lt;/p&gt;\n\n&lt;p&gt;I&amp;#39;ve been having an issue at work and can&amp;#39;t seem to figure out the correct troubleshooting steps for the situation. I&amp;#39;m usually able to fix this stuff by myself, but the problem happens randomly and it&amp;#39;s starting to feel like a wild goose chase. There &amp;quot;appear&amp;quot;  to be two issues (i.e. I don&amp;#39;t think they are related, but who knows): &lt;/p&gt;\n\n&lt;p&gt;1) Laptops in the office will randomly lose connectivity to the network. They remain connected to the AP but lose their IP and cant even ping the gateway/ap. ipconfig /release /renew doesn&amp;#39;t fix the issue, only disconnecting and reconnecting to the AP temproraly fixes the issue. Maybe it&amp;#39;s a bad NIC on the laptops side or the AP is going bad. What would be the best way to troubleshoot this be?&lt;/p&gt;\n\n&lt;p&gt;2) Since we switched ISPs DNS queries seems to randomly timeout, which means that the employees will lose connectivity to the internet. It could&amp;#39;nt be out firewall since I have run tests with laptops directly connected to the router that the ISP gave us and the problem still persists there. Also I would like to note that the DNS server I choose doesn&amp;#39;t affect the issues since I&amp;#39;ve tried with the ISP&amp;#39;s, google&amp;#39;s, and level 3&amp;#39;s DNS servers. Also something weird I noted is that the timeouts on the DNS queries do not happen at the same time for different machines. Installing DNSCrypt on the machine fixed the issue on that machine so I&amp;#39;m guessing it is on the ISPs side.. Any tips on what the best way to document/prove this to the ISP would be so they either fix it or we can break the contract? I have a pcap file where it shows pinging to 8.8.8.8 works, but performing a DNS lookup returns no response.&lt;/p&gt;\n\n&lt;p&gt;Also any advice on generally troubleshooting networking issues that occur randomly and you can&amp;#39;t reproduce? I&amp;#39;ve been thinking about learning packet capture analysis more in depth since it has helped me a lot in the past.&lt;/p&gt;\n\n&lt;p&gt;Greetings from Vienna,\nMiF &lt;/p&gt;\n&lt;/div&gt;&lt;!-- SC_ON --&gt;", "selftext": "Hello everyone, first post on r/networking so hopefully I'm not breaking any rules. (mods, feel free to remove if it does)\n\nI've been having an issue at work and can't seem to figure out the correct troubleshooting steps for the situation. I'm usually able to fix this stuff by myself, but the problem happens randomly and it's starting to feel like a wild goose chase. There \"appear\"  to be two issues (i.e. I don't think they are related, but who knows): \n\n1) Laptops in the office will randomly lose connectivity to the network. They remain connected to the AP but lose their IP and cant even ping the gateway/ap. ipconfig /release /renew doesn't fix the issue, only disconnecting and reconnecting to the AP temproraly fixes the issue. Maybe it's a bad NIC on the laptops side or the AP is going bad. What would be the best way to troubleshoot this be?\n\n\n2) Since we switched ISPs DNS queries seems to randomly timeout, which means that the employees will lose connectivity to the internet. It could'nt be out firewall since I have run tests with laptops directly connected to the router that the ISP gave us and the problem still persists there. Also I would like to note that the DNS server I choose doesn't affect the issues since I've tried with the ISP's, google's, and level 3's DNS servers. Also something weird I noted is that the timeouts on the DNS queries do not happen at the same time for different machines. Installing DNSCrypt on the machine fixed the issue on that machine so I'm guessing it is on the ISPs side.. Any tips on what the best way to document/prove this to the ISP would be so they either fix it or we can break the contract? I have a pcap file where it shows pinging to 8.8.8.8 works, but performing a DNS lookup returns no response.\n\n\nAlso any advice on generally troubleshooting networking issues that occur randomly and you can't reproduce? I've been thinking about learning packet capture analysis more in depth since it has helped me a lot in the past.\n\n\nGreetings from Vienna,\nMiF \n", "likes": null, "suggested_sort": null, "user_reports": [], "secure_media": null, "link_flair_text": null, "id": "65bhwz", "gilded": 0, "secure_media_embed": {}, "clicked": false, "score": 25, "report_reasons": null, "author": "ManipulatingIsFun", "saved": false, "mod_reports": [], "name": "t3_65bhwz", "subreddit_name_prefixed": "r/networking", "approved_by": null, "over_18": false, "domain": "self.networking", "hidden": false, "thumbnail": "", "subreddit_id": "t5_2qkaf", "edited": false, "link_flair_css_class": null, "author_flair_css_class": null, "downs": 0, "brand_safe": true, "archived": false, "removal_reason": null, "is_self": true, "hide_score": false, "spoiler": false, "permalink": "/r/networking/comments/65bhwz/troubleshooting_help_dns_queries_randomly_timeout/", "num_reports": null, "locked": false, "stickied": false, "created": 1492189208.0, "url": "https://www.reddit.com/r/networking/comments/65bhwz/troubleshooting_help_dns_queries_randomly_timeout/", "author_flair_text": null, "quarantine": false, "title": "Troubleshooting Help: DNS queries randomly timeout, DNS over HTTPS works", "created_utc": 1492160408.0, "distinguished": null, "media": null, "upvote_ratio": 0.84, "num_comments": 40, "visited": false, "subreddit_type": "public", "ups": 25}}], "after": null, "before": null}}, {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65bhwz", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65bhwz", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65bhwz", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65bhwz", "likes": null, "replies": "", "user_reports": [], "id": "dg9d7ck", "gilded": 0, "archived": false, "score": 2, "report_reasons": null, "author": "ManipulatingIsFun", "parent_id": "t1_dg9cacc", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "Yeah I think it might be that too. Not exactly using quality APs unfortunately.", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;Yeah I think it might be that too. Not exactly using quality APs unfortunately.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dg9d7ck", "score_hidden": false, "stickied": false, "created": 1492216270.0, "created_utc": 1492187470.0, "depth": 3, "mod_reports": [], "subreddit_type": "public", "ups": 2}}], "after": null, "before": null}}, "user_reports": [], "id": "dg9cacc", "gilded": 0, "archived": false, "score": 6, "report_reasons": null, "author": "Znuff", "parent_id": "t1_dg9bgvr", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "I'm more inclined to think his APs are over-crowded and they start dropping people randomly when they've reached their physical capacity.\n\nThe DHCP server will not tell his clients to give up a lease. The client loses the lease because of $reason.", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;I&amp;#39;m more inclined to think his APs are over-crowded and they start dropping people randomly when they&amp;#39;ve reached their physical capacity.&lt;/p&gt;\n\n&lt;p&gt;The DHCP server will not tell his clients to give up a lease. The client loses the lease because of $reason.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dg9cacc", "score_hidden": false, "stickied": false, "created": 1492215262.0, "created_utc": 1492186462.0, "depth": 2, "mod_reports": [], "subreddit_type": "public", "ups": 6}}, {"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65bhwz", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65bhwz", "likes": null, "replies": "", "user_reports": [], "id": "dg9mi7c", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "Znuff", "parent_id": "t1_dg9eag5", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "Please keep in mind that most consumer APs \"crap their pants\" when more than 20-30 ~~people~~ devices are connected, they simply can't keep up.", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;Please keep in mind that most consumer APs &amp;quot;crap their pants&amp;quot; when more than 20-30 &lt;del&gt;people&lt;/del&gt; devices are connected, they simply can&amp;#39;t keep up.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dg9mi7c", "score_hidden": false, "stickied": false, "created": 1492227180.0, "created_utc": 1492198380.0, "depth": 3, "mod_reports": [], "subreddit_type": "public", "ups": 1}}], "after": null, "before": null}}, "user_reports": [], "id": "dg9eag5", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "ManipulatingIsFun", "parent_id": "t1_dg9bgvr", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "I doubt its the DHCP config since it works fine when connected via cable. Sorry, didn't mention that in the original post. It's probably the AP as /u/Znuff mentioned. Unfortunately all my experience up until 8 months ago has been from self studying and I've never had hardware fail, so I suck at detecting hardware failures...", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;I doubt its the DHCP config since it works fine when connected via cable. Sorry, didn&amp;#39;t mention that in the original post. It&amp;#39;s probably the AP as &lt;a href=\"/u/Znuff\"&gt;/u/Znuff&lt;/a&gt; mentioned. Unfortunately all my experience up until 8 months ago has been from self studying and I&amp;#39;ve never had hardware fail, so I suck at detecting hardware failures...&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dg9eag5", "score_hidden": false, "stickied": false, "created": 1492217494.0, "created_utc": 1492188694.0, "depth": 2, "mod_reports": [], "subreddit_type": "public", "ups": 1}}], "after": null, "before": null}}, "user_reports": [], "id": "dg9bgvr", "gilded": 0, "archived": false, "score": 5, "report_reasons": null, "author": "neilalexanderr", "parent_id": "t1_dg95xol", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "This almost sounds like something is wrong with the DHCP configuration or server. Clients should typically look to renew their current DHCP lease after roughly half of the configured lease time has passed. If something goes wrong with that exchange then the clients may \"lose\" their IPs. ", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;This almost sounds like something is wrong with the DHCP configuration or server. Clients should typically look to renew their current DHCP lease after roughly half of the configured lease time has passed. If something goes wrong with that exchange then the clients may &amp;quot;lose&amp;quot; their IPs. &lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dg9bgvr", "score_hidden": false, "stickied": false, "created": 1492214355.0, "created_utc": 1492185555.0, "depth": 1, "mod_reports": [], "subreddit_type": "public", "ups": 5}}], "after": null, "before": null}}, "user_reports": [], "id": "dg95xol", "gilded": 0, "archived": false, "score": 14, "report_reasons": null, "author": "none_shall_pass", "parent_id": "t3_65bhwz", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "&gt; 1) Laptops in the office will randomly lose connectivity to the network. They remain connected to the AP but lose their IP\n\nYou can pretty much stop there. If the machines are losing their IP you need to find out what's wrong with your network. I don't think this has anything to do with your ISP.\n", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;blockquote&gt;\n&lt;p&gt;1) Laptops in the office will randomly lose connectivity to the network. They remain connected to the AP but lose their IP&lt;/p&gt;\n&lt;/blockquote&gt;\n\n&lt;p&gt;You can pretty much stop there. If the machines are losing their IP you need to find out what&amp;#39;s wrong with your network. I don&amp;#39;t think this has anything to do with your ISP.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dg95xol", "score_hidden": false, "stickied": false, "created": 1492207444.0, "created_utc": 1492178644.0, "depth": 0, "mod_reports": [], "subreddit_type": "public", "ups": 14}}, {"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65bhwz", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65bhwz", "likes": null, "replies": "", "user_reports": [], "id": "dg91842", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "ManipulatingIsFun", "parent_id": "t1_dg8yy36", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "Thank you for the reply. That's what we have been using. You are correct in that the local caching masked the problem and it took a while to figure out it was dns. However I have been running all tests using public DNS servers to make sure that the issue isn't on our DNS configuration. (I set up the whole network infratrucutre not too long ago, and I was worried there I might have messed something up in the configuration)", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;Thank you for the reply. That&amp;#39;s what we have been using. You are correct in that the local caching masked the problem and it took a while to figure out it was dns. However I have been running all tests using public DNS servers to make sure that the issue isn&amp;#39;t on our DNS configuration. (I set up the whole network infratrucutre not too long ago, and I was worried there I might have messed something up in the configuration)&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dg91842", "score_hidden": false, "stickied": false, "created": 1492198991.0, "created_utc": 1492170191.0, "depth": 1, "mod_reports": [], "subreddit_type": "public", "ups": 1}}], "after": null, "before": null}}, "user_reports": [], "id": "dg8yy36", "gilded": 0, "archived": false, "score": 5, "report_reasons": null, "author": "costan1", "parent_id": "t3_65bhwz", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "Install a recursive DNS inside your net and have client point to it.\n\nDo not use the ISP as forwarders, use the normal recursion from root-servers down below.\n\nProbably the local caching will mask most of the issue, but you can easily track lost packets on the DNS box.\n\nThen blame the ISP with the captured data.. probably they have some weird QoS setting on the PE/CPE queue.\n", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;Install a recursive DNS inside your net and have client point to it.&lt;/p&gt;\n\n&lt;p&gt;Do not use the ISP as forwarders, use the normal recursion from root-servers down below.&lt;/p&gt;\n\n&lt;p&gt;Probably the local caching will mask most of the issue, but you can easily track lost packets on the DNS box.&lt;/p&gt;\n\n&lt;p&gt;Then blame the ISP with the captured data.. probably they have some weird QoS setting on the PE/CPE queue.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dg8yy36", "score_hidden": false, "stickied": false, "created": 1492192230.0, "created_utc": 1492163430.0, "depth": 0, "mod_reports": [], "subreddit_type": "public", "ups": 5}}, {"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65bhwz", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65bhwz", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65bhwz", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65bhwz", "likes": null, "replies": "", "user_reports": [], "id": "dg9dn4k", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "ManipulatingIsFun", "parent_id": "t1_dg94s03", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "I will take a look at it. We do use an internal DNS server. At first I thought that I had configured it incorrectly since I had never configured bind before, but then I noticed that the issues appeared on the Guest AP which gave out google's DNS servers to clients. I will check though to make sure that we are using Root Hints and not forwaders, so thanks for that :)", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;I will take a look at it. We do use an internal DNS server. At first I thought that I had configured it incorrectly since I had never configured bind before, but then I noticed that the issues appeared on the Guest AP which gave out google&amp;#39;s DNS servers to clients. I will check though to make sure that we are using Root Hints and not forwaders, so thanks for that :)&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dg9dn4k", "score_hidden": false, "stickied": false, "created": 1492216768.0, "created_utc": 1492187968.0, "depth": 3, "mod_reports": [], "subreddit_type": "public", "ups": 1}}], "after": null, "before": null}}, "user_reports": [], "id": "dg94s03", "gilded": 0, "archived": false, "score": 3, "report_reasons": null, "author": "Skilldibop", "parent_id": "t1_dg914is", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "You can use Nagios but zabbix or something is probably better.\n\nHowever in this case I would just not rely on external DNS forwarders. Especially to ISP DNS and google public DNS as there is no SLA on those for uptime, requests per second etc. and if you send too many you can get your public IP  blacklisted or throttled and then you're in a world of pain (possibly what's currently happening).\n\nYou should really set up your own internal DNS server and use root hints for recursion. It's not hard to set up and is a much better way to do things. Plus it's necessary to use DNS for your internal stuff which you should also be doing.\n\nhttps://www.petri.com/best-practices-for-dns-forwarding  ", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;You can use Nagios but zabbix or something is probably better.&lt;/p&gt;\n\n&lt;p&gt;However in this case I would just not rely on external DNS forwarders. Especially to ISP DNS and google public DNS as there is no SLA on those for uptime, requests per second etc. and if you send too many you can get your public IP  blacklisted or throttled and then you&amp;#39;re in a world of pain (possibly what&amp;#39;s currently happening).&lt;/p&gt;\n\n&lt;p&gt;You should really set up your own internal DNS server and use root hints for recursion. It&amp;#39;s not hard to set up and is a much better way to do things. Plus it&amp;#39;s necessary to use DNS for your internal stuff which you should also be doing.&lt;/p&gt;\n\n&lt;p&gt;&lt;a href=\"https://www.petri.com/best-practices-for-dns-forwarding\"&gt;https://www.petri.com/best-practices-for-dns-forwarding&lt;/a&gt;  &lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dg94s03", "score_hidden": false, "stickied": false, "created": 1492205762.0, "created_utc": 1492176962.0, "depth": 2, "mod_reports": [], "subreddit_type": "public", "ups": 3}}], "after": null, "before": null}}, "user_reports": [], "id": "dg914is", "gilded": 0, "archived": false, "score": 2, "report_reasons": null, "author": "ManipulatingIsFun", "parent_id": "t1_dg8zeub", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "Thank you for your input. Throughout the last few days I have set done scheduled pings and scheduled nsloops and recorded all the packets using wireshark. As for monitoring, we use nagios for our severs. Any recommendations for network monitoring? ", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;Thank you for your input. Throughout the last few days I have set done scheduled pings and scheduled nsloops and recorded all the packets using wireshark. As for monitoring, we use nagios for our severs. Any recommendations for network monitoring? &lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dg914is", "score_hidden": false, "stickied": false, "created": 1492198748.0, "created_utc": 1492169948.0, "depth": 1, "mod_reports": [], "subreddit_type": "public", "ups": 2}}], "after": null, "before": null}}, "user_reports": [], "id": "dg8zeub", "gilded": 0, "archived": false, "score": 3, "report_reasons": null, "author": "Skilldibop", "parent_id": "t3_65bhwz", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "&gt; Also any advice on generally troubleshooting networking issues that occur randomly and you can't reproduce? I've been thinking about learning packet capture analysis more in depth since it has helped me a lot in the past.\n\nSet up decent monitoring.  If an issue is random and cannot be reproduced you cannot troubleshoot it after the fact.  You need to monitor the affected service and log results over time so that when it happens again the data is recorded for later review.", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;blockquote&gt;\n&lt;p&gt;Also any advice on generally troubleshooting networking issues that occur randomly and you can&amp;#39;t reproduce? I&amp;#39;ve been thinking about learning packet capture analysis more in depth since it has helped me a lot in the past.&lt;/p&gt;\n&lt;/blockquote&gt;\n\n&lt;p&gt;Set up decent monitoring.  If an issue is random and cannot be reproduced you cannot troubleshoot it after the fact.  You need to monitor the affected service and log results over time so that when it happens again the data is recorded for later review.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dg8zeub", "score_hidden": false, "stickied": false, "created": 1492193786.0, "created_utc": 1492164986.0, "depth": 0, "mod_reports": [], "subreddit_type": "public", "ups": 3}}, {"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65bhwz", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65bhwz", "likes": null, "replies": "", "user_reports": [], "id": "dg9ef6g", "gilded": 0, "archived": false, "score": 2, "report_reasons": null, "author": "ManipulatingIsFun", "parent_id": "t1_dg93q35", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "AP is shitty. AP doesn't log anything....\n\nThanks for the \" EDNS0 or MTU or TCP fallback \" suggestion. I'll look into it", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;AP is shitty. AP doesn&amp;#39;t log anything....&lt;/p&gt;\n\n&lt;p&gt;Thanks for the &amp;quot; EDNS0 or MTU or TCP fallback &amp;quot; suggestion. I&amp;#39;ll look into it&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dg9ef6g", "score_hidden": false, "stickied": false, "created": 1492217643.0, "created_utc": 1492188843.0, "depth": 1, "mod_reports": [], "subreddit_type": "public", "ups": 2}}], "after": null, "before": null}}, "user_reports": [], "id": "dg93q35", "gilded": 0, "archived": false, "score": 3, "report_reasons": null, "author": "arghcisco", "parent_id": "t3_65bhwz", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "1) You need to get into the AP and look at the logs to figure out why the laptops are dropping the connection.  Having wireless sniffer to see the management frames might help diagnose as well.\n\n2) Providing pcap files to the ISP should be sufficient, but they'll tell you whatever else they need after you open a ticket.  There's no point in trying to read their mind, just ask them what they want.\n\nThe laptops not resolving is a puzzle, I'm not sure what's going on there.  I suspect that DNS caching might be a problem.  \n\nThe other thing to check is that your firewall isn't dropping packets because of EDNS0 or MTU or TCP fallback or whatever.  A common problem is that admins who like to play the filter micromanagement game forget to open TCP port 53, which is mandatory these days because of how huge DNS PDUs have gotten. ", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;1) You need to get into the AP and look at the logs to figure out why the laptops are dropping the connection.  Having wireless sniffer to see the management frames might help diagnose as well.&lt;/p&gt;\n\n&lt;p&gt;2) Providing pcap files to the ISP should be sufficient, but they&amp;#39;ll tell you whatever else they need after you open a ticket.  There&amp;#39;s no point in trying to read their mind, just ask them what they want.&lt;/p&gt;\n\n&lt;p&gt;The laptops not resolving is a puzzle, I&amp;#39;m not sure what&amp;#39;s going on there.  I suspect that DNS caching might be a problem.  &lt;/p&gt;\n\n&lt;p&gt;The other thing to check is that your firewall isn&amp;#39;t dropping packets because of EDNS0 or MTU or TCP fallback or whatever.  A common problem is that admins who like to play the filter micromanagement game forget to open TCP port 53, which is mandatory these days because of how huge DNS PDUs have gotten. &lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dg93q35", "score_hidden": false, "stickied": false, "created": 1492204066.0, "created_utc": 1492175266.0, "depth": 0, "mod_reports": [], "subreddit_type": "public", "ups": 3}}, {"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65bhwz", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65bhwz", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65bhwz", "likes": null, "replies": "", "user_reports": [], "id": "dg9ntyj", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "WileyOneX", "parent_id": "t1_dg912ec", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "Greetings. Had a similar configuration myself with large guest Wi-Fi population (2000+) and then added Chrome books over 2000 with same config. Learned during high stakes student testing that Google throttles DNS requests from each public IP. Somewhere around 500 per second as I recall. The timeout window is random. Move your clients to internal DNS and setup your forwarders or root hints to your liking. You will not regret it. Cheers.", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;Greetings. Had a similar configuration myself with large guest Wi-Fi population (2000+) and then added Chrome books over 2000 with same config. Learned during high stakes student testing that Google throttles DNS requests from each public IP. Somewhere around 500 per second as I recall. The timeout window is random. Move your clients to internal DNS and setup your forwarders or root hints to your liking. You will not regret it. Cheers.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dg9ntyj", "score_hidden": false, "stickied": false, "created": 1492228770.0, "created_utc": 1492199970.0, "depth": 2, "mod_reports": [], "subreddit_type": "public", "ups": 1}}], "after": null, "before": null}}, "user_reports": [], "id": "dg912ec", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "ManipulatingIsFun", "parent_id": "t1_dg90or2", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "Thank you for the response. I have been gathering some logs using wireshark the past couple of days. When the issues occurs, ICMP packets send to 8.8.8.8 work correctly (i.e. I recieve a response), however DNS (UDP) queries send to 8.8.8.8 (via nslookup website.com 8.8.8.8) recieve no response at all. ", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;Thank you for the response. I have been gathering some logs using wireshark the past couple of days. When the issues occurs, ICMP packets send to 8.8.8.8 work correctly (i.e. I recieve a response), however DNS (UDP) queries send to 8.8.8.8 (via nslookup website.com 8.8.8.8) recieve no response at all. &lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dg912ec", "score_hidden": false, "stickied": false, "created": 1492198602.0, "created_utc": 1492169802.0, "depth": 1, "mod_reports": [], "subreddit_type": "public", "ups": 1}}], "after": null, "before": null}}, "user_reports": [], "id": "dg90or2", "gilded": 0, "archived": false, "score": 2, "report_reasons": null, "author": "holemilk", "parent_id": "t3_65bhwz", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "I concur with /u/Skilldibop, you'll want to gather some logs and / or set up monitoring.  Is your ISP indeed failing to respond to queries or are you getting packets back?  Even basic firewall logs should be able to indicate if the session is receiving a response.\n\nAnother angle: are these queries failing over UDP or is TCP failing as well?", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;I concur with &lt;a href=\"/u/Skilldibop\"&gt;/u/Skilldibop&lt;/a&gt;, you&amp;#39;ll want to gather some logs and / or set up monitoring.  Is your ISP indeed failing to respond to queries or are you getting packets back?  Even basic firewall logs should be able to indicate if the session is receiving a response.&lt;/p&gt;\n\n&lt;p&gt;Another angle: are these queries failing over UDP or is TCP failing as well?&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dg90or2", "score_hidden": false, "stickied": false, "created": 1492197621.0, "created_utc": 1492168821.0, "depth": 0, "mod_reports": [], "subreddit_type": "public", "ups": 2}}, {"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65bhwz", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65bhwz", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65bhwz", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65bhwz", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65bhwz", "likes": null, "replies": "", "user_reports": [], "id": "dgcwoud", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "framethatpacket", "parent_id": "t1_dg9f0fg", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "So - with your laptop connected directly to ISP router - was your laptop DNS set to your local DNS Server or were you using ISP's DNS servers? How about 8.8.8.8? If still problems - perhaps contact your ISP since it might be outside your control. Perhaps find a quick test that will always fail for you to show the ISP the problem.", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;So - with your laptop connected directly to ISP router - was your laptop DNS set to your local DNS Server or were you using ISP&amp;#39;s DNS servers? How about 8.8.8.8? If still problems - perhaps contact your ISP since it might be outside your control. Perhaps find a quick test that will always fail for you to show the ISP the problem.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dgcwoud", "score_hidden": false, "stickied": false, "created": 1492421559.0, "created_utc": 1492392759.0, "depth": 4, "mod_reports": [], "subreddit_type": "public", "ups": 1}}], "after": null, "before": null}}, "user_reports": [], "id": "dg9f0fg", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "ManipulatingIsFun", "parent_id": "t1_dg9e7c5", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "Yep Windows Firewall was off, and we don't use any other firewalls. (Except for pfsense, but as I mentioned I just plugged the laptop directly to the router thus circumventing the pfsense) \nNo worries. I do still have a lot to learn :) , and thanks for helping", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;Yep Windows Firewall was off, and we don&amp;#39;t use any other firewalls. (Except for pfsense, but as I mentioned I just plugged the laptop directly to the router thus circumventing the pfsense) \nNo worries. I do still have a lot to learn :) , and thanks for helping&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dg9f0fg", "score_hidden": false, "stickied": false, "created": 1492218308.0, "created_utc": 1492189508.0, "depth": 3, "mod_reports": [], "subreddit_type": "public", "ups": 1}}], "after": null, "before": null}}, "user_reports": [], "id": "dg9e7c5", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "spychipper", "parent_id": "t1_dg9cqsh", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "Did that include turning off windows firewall or any third party firewalls as well? (if it's on)\n\nNot implying lack of any skill here, just going down the list of items that I have forgotten in the past. Those lessons stick.", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;Did that include turning off windows firewall or any third party firewalls as well? (if it&amp;#39;s on)&lt;/p&gt;\n\n&lt;p&gt;Not implying lack of any skill here, just going down the list of items that I have forgotten in the past. Those lessons stick.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dg9e7c5", "score_hidden": false, "stickied": false, "created": 1492217398.0, "created_utc": 1492188598.0, "depth": 2, "mod_reports": [], "subreddit_type": "public", "ups": 1}}], "after": null, "before": null}}, "user_reports": [], "id": "dg9cqsh", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "ManipulatingIsFun", "parent_id": "t1_dg963ie", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "Yes I am, but I have done tests connecting my Laptop to the ISP's router directly (thus circumventing our firewall) and the problem still persists.", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;Yes I am, but I have done tests connecting my Laptop to the ISP&amp;#39;s router directly (thus circumventing our firewall) and the problem still persists.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dg9cqsh", "score_hidden": false, "stickied": false, "created": 1492215759.0, "created_utc": 1492186959.0, "depth": 1, "mod_reports": [], "subreddit_type": "public", "ups": 1}}], "after": null, "before": null}}, "user_reports": [], "id": "dg963ie", "gilded": 0, "archived": false, "score": 2, "report_reasons": null, "author": "spychipper", "parent_id": "t3_65bhwz", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "Are you using any kind of firewalling that could break the DNS? A common mistake is to think that DNS always uses UDP, it does not, it also uses TCP on the same port number.\n\nThat will not help your connectivity problem, but is something to double check for the DNS issue.", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;Are you using any kind of firewalling that could break the DNS? A common mistake is to think that DNS always uses UDP, it does not, it also uses TCP on the same port number.&lt;/p&gt;\n\n&lt;p&gt;That will not help your connectivity problem, but is something to double check for the DNS issue.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dg963ie", "score_hidden": false, "stickied": false, "created": 1492207672.0, "created_utc": 1492178872.0, "depth": 0, "mod_reports": [], "subreddit_type": "public", "ups": 2}}, {"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65bhwz", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65bhwz", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65bhwz", "likes": null, "replies": "", "user_reports": [], "id": "dg9j7nr", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "7600_slayer", "parent_id": "t1_dg9cu2n", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "So your hard wired devices are dropping out as well?", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;So your hard wired devices are dropping out as well?&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dg9j7nr", "score_hidden": false, "stickied": false, "created": 1492223209.0, "created_utc": 1492194409.0, "depth": 2, "mod_reports": [], "subreddit_type": "public", "ups": 1}}], "after": null, "before": null}}, "user_reports": [], "id": "dg9cu2n", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "ManipulatingIsFun", "parent_id": "t1_dg96709", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "I think the issues are not related. The DNS will stop working even if the client is connected to the AP correctly. ", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;I think the issues are not related. The DNS will stop working even if the client is connected to the AP correctly. &lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dg9cu2n", "score_hidden": false, "stickied": false, "created": 1492215856.0, "created_utc": 1492187056.0, "depth": 1, "mod_reports": [], "subreddit_type": "public", "ups": 1}}], "after": null, "before": null}}, "user_reports": [], "id": "dg96709", "gilded": 0, "archived": false, "score": 2, "report_reasons": null, "author": "7600_slayer", "parent_id": "t3_65bhwz", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "Could be a whole host of things. I'm assuming you're presenting all your queries from behind one /32? If the ISP is doing any sort of rate-limiting or other advanced DNS protections you could be inadvertently setting them off.\n\nHave you called and spoken to someone at the ISP about this? Sometimes all it takes is a simple conversation to get onto a whitelist etc.\n\n\nEdit:\n\nSounds like you have problems with your AP's and not your DNS if your laptops are dropping their IPs.", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;Could be a whole host of things. I&amp;#39;m assuming you&amp;#39;re presenting all your queries from behind one /32? If the ISP is doing any sort of rate-limiting or other advanced DNS protections you could be inadvertently setting them off.&lt;/p&gt;\n\n&lt;p&gt;Have you called and spoken to someone at the ISP about this? Sometimes all it takes is a simple conversation to get onto a whitelist etc.&lt;/p&gt;\n\n&lt;p&gt;Edit:&lt;/p&gt;\n\n&lt;p&gt;Sounds like you have problems with your AP&amp;#39;s and not your DNS if your laptops are dropping their IPs.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dg96709", "score_hidden": false, "stickied": false, "created": 1492207809.0, "created_utc": 1492179009.0, "depth": 0, "mod_reports": [], "subreddit_type": "public", "ups": 2}}, {"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65bhwz", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65bhwz", "likes": null, "replies": "", "user_reports": [], "id": "dg9cv15", "gilded": 0, "archived": false, "score": 2, "report_reasons": null, "author": "ManipulatingIsFun", "parent_id": "t1_dg9680f", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "Thank you, I will check to see if this is the problem.", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;Thank you, I will check to see if this is the problem.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dg9cv15", "score_hidden": false, "stickied": false, "created": 1492215886.0, "created_utc": 1492187086.0, "depth": 1, "mod_reports": [], "subreddit_type": "public", "ups": 2}}], "after": null, "before": null}}, "user_reports": [], "id": "dg9680f", "gilded": 0, "archived": false, "score": 2, "report_reasons": null, "author": "PE1NUT", "parent_id": "t3_65bhwz", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "If some DNS requests make it 'there and back again', and some don't, the difference might be TCP vs. UDP. DNS can use port 53 for both UDP based, and TCP based for larger replies. Most OS-es have a way of triggering TCP based lookups to verify this.\n\nAnother option might be DNSSEC failures, which you might see in the logfiles of your local recursive DNS server.", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;If some DNS requests make it &amp;#39;there and back again&amp;#39;, and some don&amp;#39;t, the difference might be TCP vs. UDP. DNS can use port 53 for both UDP based, and TCP based for larger replies. Most OS-es have a way of triggering TCP based lookups to verify this.&lt;/p&gt;\n\n&lt;p&gt;Another option might be DNSSEC failures, which you might see in the logfiles of your local recursive DNS server.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dg9680f", "score_hidden": false, "stickied": false, "created": 1492207847.0, "created_utc": 1492179047.0, "depth": 0, "mod_reports": [], "subreddit_type": "public", "ups": 2}}, {"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65bhwz", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65bhwz", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65bhwz", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65bhwz", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65bhwz", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65bhwz", "likes": null, "replies": "", "user_reports": [], "id": "dg9tm6u", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "pdp10", "parent_id": "t1_dg9rzkr", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "[Oh, nice.](https://damn.technology/cisco-asa-nat-problems-with-tcp-port-2000) I never ran into that particular failure case, just most of the others.\n\nFor example, an ASA will obfuscate the \"STARTTLS\" keyword in your ESMTP protocol negotiations, preventing your ESMTP transmissions from being opportunistically encrypted. Some security device that is.\n\n", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;&lt;a href=\"https://damn.technology/cisco-asa-nat-problems-with-tcp-port-2000\"&gt;Oh, nice.&lt;/a&gt; I never ran into that particular failure case, just most of the others.&lt;/p&gt;\n\n&lt;p&gt;For example, an ASA will obfuscate the &amp;quot;STARTTLS&amp;quot; keyword in your ESMTP protocol negotiations, preventing your ESMTP transmissions from being opportunistically encrypted. Some security device that is.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dg9tm6u", "score_hidden": false, "stickied": false, "created": 1492235952.0, "created_utc": 1492207152.0, "depth": 5, "mod_reports": [], "subreddit_type": "public", "ups": 1}}], "after": null, "before": null}}, "user_reports": [], "id": "dg9rzkr", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "port53", "parent_id": "t1_dg9q8o0", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "See 'Cisco tcp port 2000 problem'.", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;See &amp;#39;Cisco tcp port 2000 problem&amp;#39;.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dg9rzkr", "score_hidden": false, "stickied": false, "created": 1492233860.0, "created_utc": 1492205060.0, "depth": 4, "mod_reports": [], "subreddit_type": "public", "ups": 1}}], "after": null, "before": null}}, "user_reports": [], "id": "dg9q8o0", "gilded": 0, "archived": false, "score": 2, "report_reasons": null, "author": "pdp10", "parent_id": "t1_dg9ork8", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "EDNS can negotiate windows up to 4096 bytes of UDP, and with DNSSEC in particular 1400 bytes is a legitimate reply.\n\nBut I know all about why they do it, and in 2017 much of the reasons involve backwards compatibility and a legitimate reluctance to change default behavior that would effectively silently change a site's security policy. But that's because of the way Cisco's configs do defaults if not explicitly configured.\n\nTCP-based, IP protocol based, and DNS-based blocks cause me a lot of problems because the devices usually shouldn't be blocking things they don't understand, because today they don't understand modern protocols. Cisco tend to be the most common devices that do this, but they're far from the only culprit.\n\nLast I checked, Cisco ASAs will re-map TCP sequence numbers in an effort to protect endpoints from predictable sequence-number guessing attacks which came to light in 1995. In the process of arbitrarily changing sequence numbers they break SACK/DSACK. Sigh.\n\nTurn off anything in your middleboxes that meddles with protocols.\n\n", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;EDNS can negotiate windows up to 4096 bytes of UDP, and with DNSSEC in particular 1400 bytes is a legitimate reply.&lt;/p&gt;\n\n&lt;p&gt;But I know all about why they do it, and in 2017 much of the reasons involve backwards compatibility and a legitimate reluctance to change default behavior that would effectively silently change a site&amp;#39;s security policy. But that&amp;#39;s because of the way Cisco&amp;#39;s configs do defaults if not explicitly configured.&lt;/p&gt;\n\n&lt;p&gt;TCP-based, IP protocol based, and DNS-based blocks cause me a lot of problems because the devices usually shouldn&amp;#39;t be blocking things they don&amp;#39;t understand, because today they don&amp;#39;t understand modern protocols. Cisco tend to be the most common devices that do this, but they&amp;#39;re far from the only culprit.&lt;/p&gt;\n\n&lt;p&gt;Last I checked, Cisco ASAs will re-map TCP sequence numbers in an effort to protect endpoints from predictable sequence-number guessing attacks which came to light in 1995. In the process of arbitrarily changing sequence numbers they break SACK/DSACK. Sigh.&lt;/p&gt;\n\n&lt;p&gt;Turn off anything in your middleboxes that meddles with protocols.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dg9q8o0", "score_hidden": false, "stickied": false, "created": 1492231675.0, "created_utc": 1492202875.0, "depth": 3, "mod_reports": [], "subreddit_type": "public", "ups": 2}}], "after": null, "before": null}}, "user_reports": [], "id": "dg9ork8", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "lolklolk", "parent_id": "t1_dg99qb9", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "They block that because normal DNS queries are sized that way, and stops oversized packets (e.g. like someone DNS-reflecting) and sending 1400 byte packets full of zone info at you", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;They block that because normal DNS queries are sized that way, and stops oversized packets (e.g. like someone DNS-reflecting) and sending 1400 byte packets full of zone info at you&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dg9ork8", "score_hidden": false, "stickied": false, "created": 1492229894.0, "created_utc": 1492201094.0, "depth": 2, "mod_reports": [], "subreddit_type": "public", "ups": 1}}], "after": null, "before": null}}, "user_reports": [], "id": "dg99qb9", "gilded": 0, "archived": false, "score": 2, "report_reasons": null, "author": "pdp10", "parent_id": "t1_dg9446q", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "It's misguided firewalls that block EDNS packets (above 512 bytes) and 53/tcp, incidentally. Not usually something an ISP uses. Cisco PIX/ASA are some of the worst.\n\nPSA: Don't block DNS packets by size and don't block tcp/53.\n", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;It&amp;#39;s misguided firewalls that block EDNS packets (above 512 bytes) and 53/tcp, incidentally. Not usually something an ISP uses. Cisco PIX/ASA are some of the worst.&lt;/p&gt;\n\n&lt;p&gt;PSA: Don&amp;#39;t block DNS packets by size and don&amp;#39;t block tcp/53.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dg99qb9", "score_hidden": false, "stickied": false, "created": 1492212325.0, "created_utc": 1492183525.0, "depth": 1, "mod_reports": [], "subreddit_type": "public", "ups": 2}}], "after": null, "before": null}}, "user_reports": [], "id": "dg9446q", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "al-", "parent_id": "t3_65bhwz", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "Check stuff like EDNS reply size.\n\n`dig +short rs.dns-oarc.net txt`\n\nSee https://www.dns-oarc.net/oarc/services/replysizetest for more details.", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;Check stuff like EDNS reply size.&lt;/p&gt;\n\n&lt;p&gt;&lt;code&gt;dig +short rs.dns-oarc.net txt&lt;/code&gt;&lt;/p&gt;\n\n&lt;p&gt;See &lt;a href=\"https://www.dns-oarc.net/oarc/services/replysizetest\"&gt;https://www.dns-oarc.net/oarc/services/replysizetest&lt;/a&gt; for more details.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dg9446q", "score_hidden": false, "stickied": false, "created": 1492204720.0, "created_utc": 1492175920.0, "depth": 0, "mod_reports": [], "subreddit_type": "public", "ups": 1}}, {"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65bhwz", "likes": null, "replies": "", "user_reports": [], "id": "dg9p9kn", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "geronimo1000", "parent_id": "t3_65bhwz", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "You might check to see if there's interference or optimization you can do on the wireless side if it seems to work (more) reliably when using a cable instead of wireless. If a new AP popped up nearby on an overlapping frequency, then switching channels may help.\n\nYou can download a free tool like Wifi Analyzer for Android or Metageek Inssider for PC to see what's nearby.", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;You might check to see if there&amp;#39;s interference or optimization you can do on the wireless side if it seems to work (more) reliably when using a cable instead of wireless. If a new AP popped up nearby on an overlapping frequency, then switching channels may help.&lt;/p&gt;\n\n&lt;p&gt;You can download a free tool like Wifi Analyzer for Android or Metageek Inssider for PC to see what&amp;#39;s nearby.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dg9p9kn", "score_hidden": false, "stickied": false, "created": 1492230498.0, "created_utc": 1492201698.0, "depth": 0, "mod_reports": [], "subreddit_type": "public", "ups": 1}}, {"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65bhwz", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65bhwz", "likes": null, "replies": "", "user_reports": [], "id": "dg9czz9", "gilded": 0, "archived": false, "score": 2, "report_reasons": null, "author": "ManipulatingIsFun", "parent_id": "t1_dg99xnw", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "I meant tunneling DNS traffic through port 443 using DNSCrypt so as to be sure that my DNS queries aren't being tampered with by the ISP. And when I do that the DNS issue is resolved.  There's no reason to be mean", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;I meant tunneling DNS traffic through port 443 using DNSCrypt so as to be sure that my DNS queries aren&amp;#39;t being tampered with by the ISP. And when I do that the DNS issue is resolved.  There&amp;#39;s no reason to be mean&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dg9czz9", "score_hidden": false, "stickied": false, "created": 1492216040.0, "created_utc": 1492187240.0, "depth": 1, "mod_reports": [], "subreddit_type": "public", "ups": 2}}, {"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65bhwz", "likes": null, "replies": "", "user_reports": [], "id": "dg9f3y8", "gilded": 0, "archived": false, "score": 2, "report_reasons": null, "author": "ManipulatingIsFun", "parent_id": "t1_dg99xnw", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "Hmmm.. the first time I read your comment it sounded more hostile in my head than reading it now. Sorry for calling you mean :P ", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;Hmmm.. the first time I read your comment it sounded more hostile in my head than reading it now. Sorry for calling you mean :P &lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dg9f3y8", "score_hidden": false, "stickied": false, "created": 1492218421.0, "created_utc": 1492189621.0, "depth": 1, "mod_reports": [], "subreddit_type": "public", "ups": 2}}], "after": null, "before": null}}, "user_reports": [], "id": "dg99xnw", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "prutseratwork", "parent_id": "t3_65bhwz", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "&gt; DNS over HTTPS works \n\nThat is not how https or dns works. Since you are talking about work you might want to hire someone with more experience.", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;blockquote&gt;\n&lt;p&gt;DNS over HTTPS works &lt;/p&gt;\n&lt;/blockquote&gt;\n\n&lt;p&gt;That is not how https or dns works. Since you are talking about work you might want to hire someone with more experience.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dg99xnw", "score_hidden": false, "stickied": false, "created": 1492212569.0, "created_utc": 1492183769.0, "depth": 0, "mod_reports": [], "subreddit_type": "public", "ups": 1}}, {"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65bhwz", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65bhwz", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qkaf", "removal_reason": null, "link_id": "t3_65bhwz", "likes": null, "replies": "", "user_reports": [], "id": "dg9arqo", "gilded": 0, "archived": false, "score": 0, "report_reasons": null, "author": "flyinfishface", "parent_id": "t1_dg9anh6", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "But it's always DNS\n\n\n\nIt's not DNS\nThere's no way it's DNS\nIt was DNS", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;But it&amp;#39;s always DNS&lt;/p&gt;\n\n&lt;p&gt;It&amp;#39;s not DNS\nThere&amp;#39;s no way it&amp;#39;s DNS\nIt was DNS&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dg9arqo", "score_hidden": false, "stickied": false, "created": 1492213549.0, "created_utc": 1492184749.0, "depth": 2, "mod_reports": [], "subreddit_type": "public", "ups": 0}}], "after": null, "before": null}}, "user_reports": [], "id": "dg9anh6", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "port53", "parent_id": "t1_dg98c96", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "People who have no clue what they're doing often blame their tools.", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;People who have no clue what they&amp;#39;re doing often blame their tools.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dg9anh6", "score_hidden": false, "stickied": false, "created": 1492213412.0, "created_utc": 1492184612.0, "depth": 1, "mod_reports": [], "subreddit_type": "public", "ups": 1}}], "after": null, "before": null}}, "user_reports": [], "id": "dg98c96", "gilded": 0, "archived": false, "score": 0, "report_reasons": null, "author": "flyinfishface", "parent_id": "t3_65bhwz", "subreddit_name_prefixed": "r/networking", "controversiality": 0, "body": "Its always DNS", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;Its always DNS&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "networking", "name": "t1_dg98c96", "score_hidden": false, "stickied": false, "created": 1492210630.0, "created_utc": 1492181830.0, "depth": 0, "mod_reports": [], "subreddit_type": "public", "ups": 0}}], "after": null, "before": null}}]