[{"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t3", "data": {"contest_mode": false, "banned_by": null, "media_embed": {}, "subreddit": "sysadmin", "selftext_html": "&lt;!-- SC_OFF --&gt;&lt;div class=\"md\"&gt;&lt;p&gt;I was recently looking at ways to detect time drift or misconfigured/disabled NTP on hosts. Tools like Nagios and Zabbix are possible solutions if you use them. I did come up with a bash script to do this in a very rudimentary way and just wanted to share it, find it here &lt;a href=\"https://gist.github.com/foospidy/77c43ec2b2b71e4447f0534f7ac26798\"&gt;https://gist.github.com/foospidy/77c43ec2b2b71e4447f0534f7ac26798&lt;/a&gt;  This work was related to a blog posted on my employer&amp;#39;s blog site, which their solution incidentally has a feature that enables time drift/clock skew monitoring. (if interested the post is here &lt;a href=\"https://labs.signalsciences.com/read-this-post-especially-if-you-dont-have-time\"&gt;https://labs.signalsciences.com/read-this-post-especially-if-you-dont-have-time&lt;/a&gt;)&lt;/p&gt;\n\n&lt;p&gt;But I&amp;#39;m curious if anyone else here has seen/used other solutions for this? Open source or otherwise. I have to imagine there is a better option than my bash script :-)&lt;/p&gt;\n&lt;/div&gt;&lt;!-- SC_ON --&gt;", "selftext": "I was recently looking at ways to detect time drift or misconfigured/disabled NTP on hosts. Tools like Nagios and Zabbix are possible solutions if you use them. I did come up with a bash script to do this in a very rudimentary way and just wanted to share it, find it here https://gist.github.com/foospidy/77c43ec2b2b71e4447f0534f7ac26798  This work was related to a blog posted on my employer's blog site, which their solution incidentally has a feature that enables time drift/clock skew monitoring. (if interested the post is here https://labs.signalsciences.com/read-this-post-especially-if-you-dont-have-time)\n\nBut I'm curious if anyone else here has seen/used other solutions for this? Open source or otherwise. I have to imagine there is a better option than my bash script :-)", "likes": null, "suggested_sort": null, "user_reports": [], "secure_media": null, "link_flair_text": null, "id": "64q11x", "gilded": 0, "secure_media_embed": {}, "clicked": false, "score": 27, "report_reasons": null, "author": "foospidy", "saved": false, "mod_reports": [], "name": "t3_64q11x", "subreddit_name_prefixed": "r/sysadmin", "approved_by": null, "over_18": false, "domain": "self.sysadmin", "hidden": false, "preview": {"images": [{"source": {"url": "https://i.redditmedia.com/G3x73Ffg0rGTYJdl4Pz_Y6x-zOmUoYKw2KZz_DJVKW8.jpg?s=e612942a013cda9744590989f4db9eb6", "width": 321, "height": 321}, "resolutions": [{"url": "https://i.redditmedia.com/G3x73Ffg0rGTYJdl4Pz_Y6x-zOmUoYKw2KZz_DJVKW8.jpg?fit=crop&amp;crop=faces%2Centropy&amp;arh=2&amp;w=108&amp;s=38dc3b44d6c17ca2586d3b014ea8c70e", "width": 108, "height": 108}, {"url": "https://i.redditmedia.com/G3x73Ffg0rGTYJdl4Pz_Y6x-zOmUoYKw2KZz_DJVKW8.jpg?fit=crop&amp;crop=faces%2Centropy&amp;arh=2&amp;w=216&amp;s=7075462c351980ec010e5eeb26575b24", "width": 216, "height": 216}, {"url": "https://i.redditmedia.com/G3x73Ffg0rGTYJdl4Pz_Y6x-zOmUoYKw2KZz_DJVKW8.jpg?fit=crop&amp;crop=faces%2Centropy&amp;arh=2&amp;w=320&amp;s=3456bb27f5e64c28679a5e2a341888bc", "width": 320, "height": 320}], "variants": {}, "id": "ntbrAz3yTI7c_eEQW0f2dzDGa2sxFx7k5LHp-MeW9Dw"}], "enabled": false}, "thumbnail": "self", "subreddit_id": "t5_2qnp7", "edited": false, "link_flair_css_class": null, "author_flair_css_class": null, "downs": 0, "brand_safe": true, "archived": false, "removal_reason": null, "post_hint": "self", "is_self": true, "hide_score": false, "spoiler": false, "permalink": "/r/sysadmin/comments/64q11x/monitoring_for_time_drift_on_hosts/", "num_reports": null, "locked": false, "stickied": false, "created": 1491935539.0, "url": "https://www.reddit.com/r/sysadmin/comments/64q11x/monitoring_for_time_drift_on_hosts/", "author_flair_text": null, "quarantine": false, "title": "Monitoring for time drift on hosts", "created_utc": 1491906739.0, "distinguished": null, "media": null, "upvote_ratio": 0.87, "num_comments": 14, "visited": false, "subreddit_type": "public", "ups": 27}}], "after": null, "before": null}}, {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qnp7", "removal_reason": null, "link_id": "t3_64q11x", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qnp7", "removal_reason": null, "link_id": "t3_64q11x", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qnp7", "removal_reason": null, "link_id": "t3_64q11x", "likes": null, "replies": "", "user_reports": [], "id": "dg46ocm", "gilded": 0, "archived": false, "score": 5, "report_reasons": null, "author": "Xzariner", "parent_id": "t1_dg449ky", "subreddit_name_prefixed": "r/sysadmin", "controversiality": 0, "body": "If you use that you should also check stratum of upstream server, high one means server lost sync with upstream", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;If you use that you should also check stratum of upstream server, high one means server lost sync with upstream&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "sysadmin", "name": "t1_dg46ocm", "score_hidden": false, "stickied": false, "created": 1491942709.0, "created_utc": 1491913909.0, "depth": 2, "mod_reports": [], "subreddit_type": "public", "ups": 5}}], "after": null, "before": null}}, "user_reports": [], "id": "dg449ky", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "foospidy", "parent_id": "t1_dg43wtb", "subreddit_name_prefixed": "r/sysadmin", "controversiality": 0, "body": "Great suggestions, thanks! Seems like ntpdate -q is a simple/practical way to go.", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;Great suggestions, thanks! Seems like ntpdate -q is a simple/practical way to go.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "sysadmin", "name": "t1_dg449ky", "score_hidden": false, "stickied": false, "created": 1491937748.0, "created_utc": 1491908948.0, "depth": 1, "mod_reports": [], "subreddit_type": "public", "ups": 1}}], "after": null, "before": null}}, "user_reports": [], "id": "dg43wtb", "gilded": 0, "archived": false, "score": 9, "report_reasons": null, "author": "Xzariner", "parent_id": "t3_64q11x", "subreddit_name_prefixed": "r/sysadmin", "controversiality": 0, "body": "If your hosts are running ntp it makes more sense to do reverse check.\n\nI won't paste whole script (legal etc and it is trivial enough) but you can fire `ntpdate -q your.org.time.server` and that will return current time skew on the host. We have that plugged into nrpe (nagios's \"run check on remote host\" solution, most monitoring system have a variant of it.\n\nAlternative is just opening NTP port to your monitoring machine and doing similiar check but that's unreliable (ntp server time != system time).\n\nIf you want to be REALLY fancy you can also query local ntp server and get info about how many sources are up and synced (via ntpdc or chronyc, depending on which ntp server you are using\n", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;If your hosts are running ntp it makes more sense to do reverse check.&lt;/p&gt;\n\n&lt;p&gt;I won&amp;#39;t paste whole script (legal etc and it is trivial enough) but you can fire &lt;code&gt;ntpdate -q your.org.time.server&lt;/code&gt; and that will return current time skew on the host. We have that plugged into nrpe (nagios&amp;#39;s &amp;quot;run check on remote host&amp;quot; solution, most monitoring system have a variant of it.&lt;/p&gt;\n\n&lt;p&gt;Alternative is just opening NTP port to your monitoring machine and doing similiar check but that&amp;#39;s unreliable (ntp server time != system time).&lt;/p&gt;\n\n&lt;p&gt;If you want to be REALLY fancy you can also query local ntp server and get info about how many sources are up and synced (via ntpdc or chronyc, depending on which ntp server you are using&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "sysadmin", "name": "t1_dg43wtb", "score_hidden": false, "stickied": false, "created": 1491936838.0, "created_utc": 1491908038.0, "depth": 0, "mod_reports": [], "subreddit_type": "public", "ups": 9}}, {"kind": "t1", "data": {"subreddit_id": "t5_2qnp7", "removal_reason": null, "link_id": "t3_64q11x", "likes": null, "replies": "", "user_reports": [], "id": "dg44fzy", "gilded": 0, "archived": false, "score": 3, "report_reasons": null, "author": "fireflasch", "parent_id": "t3_64q11x", "subreddit_name_prefixed": "r/sysadmin", "controversiality": 0, "body": "we are doing those checks with icinga, against the timeserver to see the time difference.\n\nThe script used, in essential uses ntpdate -q and parses the output.", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;we are doing those checks with icinga, against the timeserver to see the time difference.&lt;/p&gt;\n\n&lt;p&gt;The script used, in essential uses ntpdate -q and parses the output.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "sysadmin", "name": "t1_dg44fzy", "score_hidden": false, "stickied": false, "created": 1491938178.0, "created_utc": 1491909378.0, "depth": 0, "mod_reports": [], "subreddit_type": "public", "ups": 3}}, {"kind": "t1", "data": {"subreddit_id": "t5_2qnp7", "removal_reason": null, "link_id": "t3_64q11x", "likes": null, "replies": "", "user_reports": [], "id": "dg46xh2", "gilded": 0, "archived": false, "score": 2, "report_reasons": null, "author": "ckozler", "parent_id": "t3_64q11x", "subreddit_name_prefixed": "r/sysadmin", "controversiality": 0, "body": "One suggestion I'd like to make is that I realize you used SSH because its there and available but something like sshpass isnt the most ideal for something like this as it means you have to store the password somewhere. You could drop that and use keys. Take it one step further for security and drop using SSH for this and instead use SNMP to get the time. Less exposure surface using SNMP ", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;One suggestion I&amp;#39;d like to make is that I realize you used SSH because its there and available but something like sshpass isnt the most ideal for something like this as it means you have to store the password somewhere. You could drop that and use keys. Take it one step further for security and drop using SSH for this and instead use SNMP to get the time. Less exposure surface using SNMP &lt;/p&gt;\n&lt;/div&gt;", "subreddit": "sysadmin", "name": "t1_dg46xh2", "score_hidden": false, "stickied": false, "created": 1491943134.0, "created_utc": 1491914334.0, "depth": 0, "mod_reports": [], "subreddit_type": "public", "ups": 2}}, {"kind": "t1", "data": {"subreddit_id": "t5_2qnp7", "removal_reason": null, "link_id": "t3_64q11x", "likes": null, "replies": "", "user_reports": [], "id": "dg46ygt", "gilded": 0, "archived": false, "score": 2, "report_reasons": null, "author": "kcornet", "parent_id": "t3_64q11x", "subreddit_name_prefixed": "r/sysadmin", "controversiality": 0, "body": "I have a perl script that builds an NTP request packet and fires it off to our NTP servers. It reads the replies and displays the stratum, offset, and reference clock.", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;I have a perl script that builds an NTP request packet and fires it off to our NTP servers. It reads the replies and displays the stratum, offset, and reference clock.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "sysadmin", "name": "t1_dg46ygt", "score_hidden": false, "stickied": false, "created": 1491943178.0, "created_utc": 1491914378.0, "depth": 0, "mod_reports": [], "subreddit_type": "public", "ups": 2}}, {"kind": "t1", "data": {"subreddit_id": "t5_2qnp7", "removal_reason": null, "link_id": "t3_64q11x", "likes": null, "replies": "", "user_reports": [], "id": "dg4a9zb", "gilded": 0, "archived": false, "score": 2, "report_reasons": null, "author": "hayjumper", "parent_id": "t3_64q11x", "subreddit_name_prefixed": "r/sysadmin", "controversiality": 0, "body": "We use Zabbix to check time drift &amp; to ensure ntp daemon process is running:\n\n    system.localtime.fuzzytime(5)&lt;&gt;0\n    proc.num[ntpd].last()&lt;&gt;0", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;We use Zabbix to check time drift &amp;amp; to ensure ntp daemon process is running:&lt;/p&gt;\n\n&lt;pre&gt;&lt;code&gt;system.localtime.fuzzytime(5)&amp;lt;&amp;gt;0\nproc.num[ntpd].last()&amp;lt;&amp;gt;0\n&lt;/code&gt;&lt;/pre&gt;\n&lt;/div&gt;", "subreddit": "sysadmin", "name": "t1_dg4a9zb", "score_hidden": false, "stickied": false, "created": 1491947974.0, "created_utc": 1491919174.0, "depth": 0, "mod_reports": [], "subreddit_type": "public", "ups": 2}}, {"kind": "t1", "data": {"subreddit_id": "t5_2qnp7", "removal_reason": null, "link_id": "t3_64q11x", "likes": null, "replies": "", "user_reports": [], "id": "dg4q7w8", "gilded": 0, "archived": false, "score": 2, "report_reasons": null, "author": "sgourou", "parent_id": "t3_64q11x", "subreddit_name_prefixed": "r/sysadmin", "controversiality": 0, "body": "we are an MSP, so we have our RMM run a small script to measure NTP offset weekly across customer servers in all different timezones and locations, output the result back to associate with a custom value tied to the RMM agent, and have weekly report of what falls outside acceptable range. this is a simple 2-step script:\n\nstep 1 outputs to text file (provides historical record), and a temp variable:\nw32tm /monitor /computers:us.pool.ntp.org | find \"NTP:\" &gt;&gt; c:\\temp\\offset.txt &amp; for /f \"tokens=2 delims=+-.\" %a IN (c:\\temp\\offset.txt) DO ECHO %a\n\nSecond step is a parser for the variable that marks the result as \"normal\", \"warning\", or \"Problem\", and outputs both to custom agent property. Report queries this value across all customers and filters out \"normal\".", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;we are an MSP, so we have our RMM run a small script to measure NTP offset weekly across customer servers in all different timezones and locations, output the result back to associate with a custom value tied to the RMM agent, and have weekly report of what falls outside acceptable range. this is a simple 2-step script:&lt;/p&gt;\n\n&lt;p&gt;step 1 outputs to text file (provides historical record), and a temp variable:\nw32tm /monitor /computers:us.pool.ntp.org | find &amp;quot;NTP:&amp;quot; &amp;gt;&amp;gt; c:\\temp\\offset.txt &amp;amp; for /f &amp;quot;tokens=2 delims=+-.&amp;quot; %a IN (c:\\temp\\offset.txt) DO ECHO %a&lt;/p&gt;\n\n&lt;p&gt;Second step is a parser for the variable that marks the result as &amp;quot;normal&amp;quot;, &amp;quot;warning&amp;quot;, or &amp;quot;Problem&amp;quot;, and outputs both to custom agent property. Report queries this value across all customers and filters out &amp;quot;normal&amp;quot;.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "sysadmin", "name": "t1_dg4q7w8", "score_hidden": false, "stickied": false, "created": 1491965790.0, "created_utc": 1491936990.0, "depth": 0, "mod_reports": [], "subreddit_type": "public", "ups": 2}}, {"kind": "t1", "data": {"subreddit_id": "t5_2qnp7", "removal_reason": null, "link_id": "t3_64q11x", "likes": null, "replies": "", "user_reports": [], "id": "dg4virh", "gilded": 0, "archived": false, "score": 2, "report_reasons": null, "author": "pdp10", "parent_id": "t3_64q11x", "subreddit_name_prefixed": "r/sysadmin", "controversiality": 0, "body": "`ntpdc` client protocol, as long as you're running a compatible ntpd and you can configure it with appropriate access control, to be on the safe side.\n", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;&lt;code&gt;ntpdc&lt;/code&gt; client protocol, as long as you&amp;#39;re running a compatible ntpd and you can configure it with appropriate access control, to be on the safe side.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "sysadmin", "name": "t1_dg4virh", "score_hidden": false, "stickied": false, "created": 1491971555.0, "created_utc": 1491942755.0, "depth": 0, "mod_reports": [], "subreddit_type": "public", "ups": 2}}, {"kind": "t1", "data": {"subreddit_id": "t5_2qnp7", "removal_reason": null, "link_id": "t3_64q11x", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qnp7", "removal_reason": null, "link_id": "t3_64q11x", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qnp7", "removal_reason": null, "link_id": "t3_64q11x", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qnp7", "removal_reason": null, "link_id": "t3_64q11x", "likes": null, "replies": {"kind": "Listing", "data": {"modhash": "", "children": [{"kind": "t1", "data": {"subreddit_id": "t5_2qnp7", "removal_reason": null, "link_id": "t3_64q11x", "likes": null, "replies": "", "user_reports": [], "id": "dg7lg2p", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "Freakin_A", "parent_id": "t1_dg7ju62", "subreddit_name_prefixed": "r/sysadmin", "controversiality": 0, "body": "You should look into it some more. There are numerous pre-built modules and code samples. Ntp management is often used as a \"hello world\" tutorial for puppet", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;You should look into it some more. There are numerous pre-built modules and code samples. Ntp management is often used as a &amp;quot;hello world&amp;quot; tutorial for puppet&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "sysadmin", "name": "t1_dg7lg2p", "score_hidden": false, "stickied": false, "created": 1492121621.0, "created_utc": 1492092821.0, "depth": 4, "mod_reports": [], "subreddit_type": "public", "ups": 1}}], "after": null, "before": null}}, "user_reports": [], "id": "dg7ju62", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "foospidy", "parent_id": "t1_dg4zvza", "subreddit_name_prefixed": "r/sysadmin", "controversiality": 0, "body": "I agree, and think those config management tools are a good option as well. I mention these in the blog post, but unfortunately I don't have any code examples to share. I have not yet mastered the art of Chef, Puppet, or Ansible :-)", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;I agree, and think those config management tools are a good option as well. I mention these in the blog post, but unfortunately I don&amp;#39;t have any code examples to share. I have not yet mastered the art of Chef, Puppet, or Ansible :-)&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "sysadmin", "name": "t1_dg7ju62", "score_hidden": false, "stickied": false, "created": 1492119566.0, "created_utc": 1492090766.0, "depth": 3, "mod_reports": [], "subreddit_type": "public", "ups": 1}}], "after": null, "before": null}}, "user_reports": [], "id": "dg4zvza", "gilded": 0, "archived": false, "score": 2, "report_reasons": null, "author": "Freakin_A", "parent_id": "t1_dg4pjxe", "subreddit_name_prefixed": "r/sysadmin", "controversiality": 0, "body": "If you care enough about a certain configuration parameter that you are checking it periodically, you should instead use a configuration management tool (puppet/chef/etc) and set it for the lifecycle of the device.  ", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;If you care enough about a certain configuration parameter that you are checking it periodically, you should instead use a configuration management tool (puppet/chef/etc) and set it for the lifecycle of the device.  &lt;/p&gt;\n&lt;/div&gt;", "subreddit": "sysadmin", "name": "t1_dg4zvza", "score_hidden": false, "stickied": false, "created": 1491976707.0, "created_utc": 1491947907.0, "depth": 2, "mod_reports": [], "subreddit_type": "public", "ups": 2}}], "after": null, "before": null}}, "user_reports": [], "id": "dg4pjxe", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "foospidy", "parent_id": "t1_dg4jfqh", "subreddit_name_prefixed": "r/sysadmin", "controversiality": 0, "body": "In theory yes. But over time things change and config can get mucked up. Granted, if you have a tight process around config this shouldn't happen. However, new deployments, deploying across on-prem and cloud, new infra via acquisitions can complicate things.", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;In theory yes. But over time things change and config can get mucked up. Granted, if you have a tight process around config this shouldn&amp;#39;t happen. However, new deployments, deploying across on-prem and cloud, new infra via acquisitions can complicate things.&lt;/p&gt;\n&lt;/div&gt;", "subreddit": "sysadmin", "name": "t1_dg4pjxe", "score_hidden": false, "stickied": false, "created": 1491965094.0, "created_utc": 1491936294.0, "depth": 1, "mod_reports": [], "subreddit_type": "public", "ups": 1}}], "after": null, "before": null}}, "user_reports": [], "id": "dg4jfqh", "gilded": 0, "archived": false, "score": 1, "report_reasons": null, "author": "qmriis", "parent_id": "t3_64q11x", "subreddit_name_prefixed": "r/sysadmin", "controversiality": 0, "body": "ntpd and forget about it ? ", "edited": false, "downs": 0, "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;ntpd and forget about it ? &lt;/p&gt;\n&lt;/div&gt;", "subreddit": "sysadmin", "name": "t1_dg4jfqh", "score_hidden": false, "stickied": false, "created": 1491958395.0, "created_utc": 1491929595.0, "depth": 0, "mod_reports": [], "subreddit_type": "public", "ups": 1}}], "after": null, "before": null}}]